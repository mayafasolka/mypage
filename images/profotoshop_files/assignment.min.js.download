var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,d){c!=Array.prototype&&c!=Object.prototype&&(c[e]=d.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var e=0;return $jscomp.iteratorPrototype(function(){return e<c.length?{done:!1,value:c[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,e){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var d=0,a={next:function(){if(d<c.length){var b=d++;return{value:e(b,c[b]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill=function(c,e,d,a){if(e){d=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var b=c[a];b in d||(d[b]={});d=d[b]}c=c[c.length-1];a=d[c];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,d,a){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==a||a>b)a=b;a=Number(a);0>a&&(a=Math.max(0,b+a));for(d=Number(d||0);d<a;d++)this[d]=c;return this}},"es6","es3");$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var e=c[Symbol.iterator];return e?e.call(c):$jscomp.arrayIterator(c)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function e(){this.batch_=null}function d(a){return a instanceof b?a:new b(function(b,f){b(a)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;e.prototype.asyncExecute=function(b){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(b);return this};e.prototype.asyncExecuteBatch_=function(){var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})};var a=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(b){a(b,
0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var f=b[a];delete b[a];try{f()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};e.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var b=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{b(a.resolve,a.reject)}catch(h){a.reject(h)}};b.prototype.createResolveAndReject_=
function(){function b(b){return function(c){f||(f=!0,b.call(a,c))}}var a=this,f=!1;return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};b.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var f=null!=a;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};b.prototype.resolveToNonPromiseObj_=function(b){var a=
void 0;try{a=b.then}catch(h){this.reject_(h);return}"function"==typeof a?this.settleSameAsThenable_(a,b):this.fulfill_(b)};b.prototype.reject_=function(b){this.settle_(2,b)};b.prototype.fulfill_=function(b){this.settle_(1,b)};b.prototype.settle_=function(b,a){if(0!=this.state_)throw Error("Cannot settle("+b+", "+a|"): Promise already settled in state"+this.state_);this.state_=b;this.result_=a;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=
this.onSettledCallbacks_,a=0;a<b.length;++a)b[a].call(),b[a]=null;this.onSettledCallbacks_=null}};var f=new e;b.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};b.prototype.settleSameAsThenable_=function(b,a){var f=this.createResolveAndReject_();try{b.call(a,f.resolve,f.reject)}catch(l){f.reject(l)}};b.prototype.then=function(a,f){function c(b,a){return"function"==typeof b?function(a){try{d(b(a))}catch(t){g(t)}}:a}var d,g,k=new b(function(b,
a){d=b;g=a});this.callWhenSettled_(c(a,d),c(f,g));return k};b.prototype.catch=function(b){return this.then(void 0,b)};b.prototype.callWhenSettled_=function(b,a){function c(){switch(d.state_){case 1:b(d.result_);break;case 2:a(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};b.resolve=d;b.reject=function(a){return new b(function(b,f){f(a)})};b.race=function(a){return new b(function(b,
f){for(var c=$jscomp.makeIterator(a),g=c.next();!g.done;g=c.next())d(g.value).callWhenSettled_(b,f)})};b.all=function(a){var f=$jscomp.makeIterator(a),c=f.next();return c.done?d([]):new b(function(b,a){function g(a){return function(f){k[a]=f;h--;0==h&&b(k)}}var k=[],h=0;do k.push(void 0),h++,d(c.value).callWhenSettled_(g(k.length-1),a),c=f.next();while(!c.done)})};return b},"es6","es3");
$jscomp.findInternal=function(c,e,d){c instanceof String&&(c=String(c));for(var a=c.length,b=0;b<a;b++){var f=c[b];if(e.call(d,f,b,c))return{i:b,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,d){return $jscomp.findInternal(this,c,d).v}},"es6","es3");
var __extends=this&&this.__extends||function(c,e){function d(){this.constructor=c}for(var a in e)e.hasOwnProperty(a)&&(c[a]=e[a]);c.prototype=null===e?Object.create(e):(d.prototype=e.prototype,new d)},Annotations;(function(c){c=c.Drawing||(c.Drawing={});c=c.AllowedEvents||(c.AllowedEvents={});c[c.redraw=0]="redraw";c[c.mouseup=1]="mouseup";c[c.mousedown=2]="mousedown";c[c.mouseenter=3]="mouseenter";c[c.mouseleave=4]="mouseleave"})(Annotations||(Annotations={}));
(function(c){(function(c){(function(c){var a=function(){function b(){}b.black=[0,0,0,255];b.red=[255,0,0,255];b.green=[0,255,0,255];b.blue=[0,0,255,255];b.transparent=[0,0,0,1];return b}();c.Color=a;a=function(){function b(){}b.width1=2;b.width2=5;b.width3=7;b.width4=10;b.eraserWidth=10;return b}();c.Width=a})(c.PencilSettings||(c.PencilSettings={}))})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){(function(e){var d=function(){function a(){this.average=function(b){return b.reduce(function(b,a){return b+a})/b.length}}a.prototype.scroll=function(b,a,d){if(b){var f=document.getElementById("viewerContainer"),g=c.AnnotationApp.pdfViewerInstance.pdfViewer,e=g._pages[a-1];e&&e.viewport&&e.scale&&(b=this.getCenterOfDrawing(b),b={x:b.x*e.scale,y:b.y*e.scale},this.isDrawingVisibleForUser(b,f,d)||(d=f.getBoundingClientRect().width,f=f.getBoundingClientRect().height,e=e.viewport.convertToPdfPoint(b.x-
d/2,b.y-f/2),g.scrollPageIntoView({pageNumber:a,destArray:[null,{name:"XYZ"},e[0],e[1],null]})))}};a.prototype.isDrawingVisibleForUser=function(b,a,c){var f=this.xMinVisible(a,c),d=this.xMaxVisible(a,c),g=this.yMinVisible(a,c);a=this.yMaxVisible(a,c);c=b.x;b=b.y;return c>f&&c<d&&b>g&&b<a?!0:!1};a.prototype.xMinVisible=function(b,a){b=b.getBoundingClientRect().left-a.getBoundingClientRect().left;return Math.max(b,0)};a.prototype.xMaxVisible=function(b,a){b=b.getBoundingClientRect().right-a.getBoundingClientRect().left;
return Math.min(b,a.getBoundingClientRect().width)};a.prototype.yMinVisible=function(b,a){b=b.getBoundingClientRect().top-a.getBoundingClientRect().top;return Math.max(b,0)};a.prototype.yMaxVisible=function(b,a){b=b.getBoundingClientRect().bottom-a.getBoundingClientRect().top;return Math.min(b,a.getBoundingClientRect().height)};a.prototype.getCenterOfDrawing=function(b){var a=b.map(function(b){return b.x});b=b.map(function(b){return b.y});return{x:this.average(a),y:this.average(b)}};return a}();e.ScrollToDrawing=
d})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){(function(c){var d=function(){function a(b){this.opened=!1;this.bar=document.getElementById(b)}a.prototype.open=function(){this.opened||(this.opened=!0,this.bar.classList.remove("hidden"),document.dispatchEvent(new Event(Assignment.Constants.Events.AnnotationDrawingActive)))};a.prototype.close=function(){this.opened&&(this.opened=!1,this.bar.classList.add("hidden"))};return a}();c.DrawBar=d})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){(function(c){var d=function(){function a(b){this.cursorSize=31;this.colorIconMap=(a={},a["#000000"]="pencil-black",a["#FF0000"]="pencil-red",a["#00FF00"]="pencil-green",a["#0000FF"]="pencil-blue",a);this.iconBasePath=b;var a}a.prototype.getDrawCursorStyle=function(b){return this.getCursorStyle(!0,b)};a.prototype.getEraseCursorStyle=function(b){return this.getCursorStyle(!1,b)};a.prototype.getIconUri=function(b,a){if(!b)return this.getFullUrl("eraser-black");b=this.rgbToHex(a[0],a[1],
a[2]);return(b=this.colorIconMap[b])?this.getFullUrl(b):this.getFullUrl("pencil-black")};a.prototype.getCursorStyle=function(b,a){return"url("+this.getIconUri(b,a)+") 0 "+this.cursorSize+", auto"};a.prototype.getFullUrl=function(b){return this.iconBasePath+"/"+b+".svg"};a.prototype.componentToHex=function(b){b=b.toString(16);return 1===b.length?"0"+b:b};a.prototype.rgbToHex=function(b,a,c){return("#"+this.componentToHex(b)+this.componentToHex(a)+this.componentToHex(c)).toUpperCase()};return a}();
c.CursorProvider=d})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){(function(e){var d=function(){return function(b){this.element=document.getElementById(b)}}(),a=function(b){function a(a,f){b.call(this,a);this.color=f}__extends(a,b);return a}(d),b=function(b){function a(a,f){b.call(this,a);this.width=f}__extends(a,b);return a}(d),f=function(b){function a(a,f){b.call(this,a);this.elementId=a;this.clickHandler=f}__extends(a,b);return a}(d),g=function(){return function(b){this.pageNumber=b}}();d=function(){function d(c,d){var h=this;this.currentWidth=e.PencilSettings.Width.width2;
this.currentColor=e.PencilSettings.Color.black;this.drawingHistory=[];this.drawingHistoryPosition=-1;this.redoButton=document.getElementById("redo");this.undoButton=document.getElementById("undo");this.onEndDrawing=function(b){b=b.pageNumber;0<=h.drawingHistoryPosition&&(h.drawingHistory=h.drawingHistory.slice(0,h.drawingHistoryPosition+1));h.drawingHistory.push(new g(b));h.drawingHistoryPosition=h.drawingHistory.length-1;h.setUndoRedoAvailability();h.saveDrawing(b)};this.saveDrawing=function(b){var a=
h.drawingInstances[b].getDataToSave();a||(a=[]);a={FileId:h.settings.FileRepoId,Annotation:{Page:b,Type:2},Shape:{Structure:JSON.stringify(a)},Comment:{}};h.storage.addUpdateDrawing(b,a)};this.clearDrawingInstances=function(){document.removeEventListener("cfd_enddrawing",h.onEndDrawing);Object.keys(h.drawingInstances).forEach(function(b){h.drawingInstances[b].disableDrawingMode()})};this.settings=c;this.storage=d;this.drawingInstances={};this.drawBar=new e.DrawBar("drawbar");this.scrollToDrawing=
new e.ScrollToDrawing;this.annotationTools=[new f("pencil",function(){h.drawBar.open();h.toggleTextLayersVisibility(!1);Object.keys(h.drawingInstances).forEach(function(b){h.drawingInstances[b].setDrawingColor(h.currentColor,!0);h.drawingInstances[b].setLineWidth(h.currentWidth)})}),new f("eraser",function(){h.drawBar.close();h.toggleTextLayersVisibility(!1);Object.keys(h.drawingInstances).forEach(function(b){h.drawingInstances[b].setDrawingColor(e.PencilSettings.Color.transparent,!0);h.drawingInstances[b].setLineWidth(e.PencilSettings.Width.eraserWidth)});
document.dispatchEvent(new Event(Assignment.Constants.Events.AnnotationDrawingActive))}),new f("comment",function(){h.drawBar.close();h.toggleTextLayersVisibility(!0)}),new f("scroll",function(){h.drawBar.close();h.toggleTextLayersVisibility(!0)})];Tools.Misc.isTouchDevice()&&this.showScrollButton();this.currentTool=this.annotationTools[2];this.pencilColors=[new a("pencil-black",e.PencilSettings.Color.black),new a("pencil-red",e.PencilSettings.Color.red),new a("pencil-green",e.PencilSettings.Color.green),
new a("pencil-blue",e.PencilSettings.Color.blue)];this.pencilWidths=[new b("pencil-width1",e.PencilSettings.Width.width1),new b("pencil-width2",e.PencilSettings.Width.width2),new b("pencil-width3",e.PencilSettings.Width.width3),new b("pencil-width4",e.PencilSettings.Width.width4)];this.attachEvents()}d.prototype.toggleTextLayersVisibility=function(b){for(var a=0,f=document.querySelectorAll(".textLayer");a<f.length;a++)f[a].style.display=b?"":"none";a=0;for(f=document.querySelectorAll(".annotationLayer");a<
f.length;a++){var c=f[a],d=c.parentNode;if(b)d.appendChild(c);else{var g=d.getElementsByClassName("canvasWrapper")[0];d.insertBefore(c,g)}}this.adjustScrolling(!b)};d.prototype.showScrollButton=function(){var b=document.getElementById("scroll");b&&(b.style.display="block")};d.prototype.attachEvents=function(){for(var b=this,a=function(a){if(!a.element)return"continue";a.element.addEventListener("click",function(){b.currentTool=a;b.setElementInArrayActive(a,b.annotationTools);a.clickHandler()})},f=
0,c=this.annotationTools;f<c.length;f++)a(c[f]);a=function(a){if(!a.element)return"continue";a.element.addEventListener("click",function(){Object.keys(b.drawingInstances).forEach(function(f){b.drawingInstances[f].setDrawingColor(a.color,!0)});b.currentColor=a.color;b.setElementInArrayActive(a,b.pencilColors)})};f=0;for(c=this.pencilColors;f<c.length;f++)a(c[f]);a=function(a){if(!a.element)return"continue";a.element.addEventListener("click",function(){Object.keys(b.drawingInstances).forEach(function(f){b.drawingInstances[f].setLineWidth(a.width)});
b.currentWidth=a.width;b.setElementInArrayActive(a,b.pencilWidths)})};f=0;for(c=this.pencilWidths;f<c.length;f++)a(c[f]);this.redoButton&&this.redoButton.addEventListener("click",function(){return b.redo()});this.undoButton&&this.undoButton.addEventListener("click",function(){return b.undo()});window.addEventListener("keyup",function(a){a.ctrlKey&&"KeyY"===a.code||a.ctrlKey&&a.shiftKey&&"KeyZ"===a.code?b.redo():a.ctrlKey&&"KeyZ"===a.code&&b.undo()});document.addEventListener("cfd_enddrawing",this.onEndDrawing);
document.addEventListener("cfd_pendrawingstart",function(){return b.adjustScrollingForPen(!0)});document.addEventListener("cfd_pendrawingend",function(){return b.adjustScrollingForPen(!1)});document.addEventListener(Assignment.Constants.Events.AnswerViewingFinished,this.clearDrawingInstances)};d.prototype.undo=function(){0<=this.drawingHistoryPosition&&(--this.drawingHistoryPosition,this.handleHistoryItem(this.drawingHistory[this.drawingHistoryPosition+1],!0))};d.prototype.redo=function(){this.drawingHistoryPosition<
this.drawingHistory.length-1&&(this.drawingHistoryPosition+=1,this.handleHistoryItem(this.drawingHistory[this.drawingHistoryPosition],!1))};d.prototype.handleHistoryItem=function(b,a){var f=this;this.setUndoRedoAvailability();var c=this.drawingInstances[b.pageNumber],d=c.getUndoRedoPointPosition(a);this.scrollToDrawing.scroll(d,b.pageNumber,c.canvas);setTimeout(function(){a?f.drawingInstances[b.pageNumber].undo():f.drawingInstances[b.pageNumber].redo();f.saveDrawing(b.pageNumber)},150)};d.prototype.setUndoRedoAvailability=
function(){this.undoButton.disabled=-1===this.drawingHistoryPosition;this.redoButton.disabled=this.drawingHistoryPosition===this.drawingHistory.length-1};d.prototype.setElementInArrayActive=function(b,a){for(var f=0;f<a.length;f++){var c=a[f];c.element&&c.element.classList.remove("active")}b.element.classList.add("active")};d.prototype.adjustScrolling=function(b){var a=this,f=document.getElementById("viewerContainer");Tools.Misc.isTouchDevice()&&(Object.keys(this.drawingInstances).forEach(function(f){a.drawingInstances[f].canvas.style.touchAction=
b?"none":"auto"}),b?(f.addEventListener("touchmove",this.preventDefault,{passive:!1}),f.addEventListener("touchforcechange",this.preventDefault,{passive:!1})):(f.removeEventListener("touchmove",this.preventDefault),f.removeEventListener("touchforcechange",this.preventDefault)));!b&&Tools.Misc.isTouchDevice()&&this.adjustScrollingForPen(!1)};d.prototype.adjustScrollingForPen=function(b){var a=document.getElementById("viewerContainer");this.showScrollButton();if(b){var f=a.scrollTop;a.onscroll=function(){a.scrollTo(0,
f)}}else a.onscroll=function(){}};d.prototype.preventDefault=function(b){b.preventDefault()};d.prototype.renderLayer=function(b,a,f,g){void 0===f&&(f=0);void 0===g&&(g=0);var k=document.querySelector('.page[data-page-number="'+b+'"] canvas');k&&(f=k.clientWidth,g=k.clientHeight);0!==f&&0!==g||console.error("Something went wrong when rendering the drawing layer.");var e=document.createElement("canvas"),h=d.drawingLayerIdPrefix+b;e.id=h;e.style.position="relative";e.style.top=-g+"px";e.style.touchAction=
"none";k?k.insertAdjacentElement("afterend",e):(k=document.getElementById(d.printContainerId),e.style.display="none",k.insertAdjacentElement("beforeend",e));a=new c.Drawing.FreeDrawing({elementId:h,pageNumber:b,width:f,height:g,backgroundColor:[255,255,255,0],showWarnings:!0,scale:a,cursorsFolder:this.settings.CursorsFolder});this.drawingInstances[b]=a};d.prototype.renderDrawing=function(b,a){this.drawingInstances[a].restore(b);this.drawingInstances[a].setLineWidth(this.currentWidth)};d.prototype.getCanvasByPage=
function(b){return this.drawingInstances[b]?this.drawingInstances[b].canvas:null};d.prototype.ensureDrawing=function(){this.isDrawingToolsActive()&&this.currentTool.clickHandler()};d.prototype.isDrawingToolsActive=function(){return"pencil"===this.currentTool.elementId||"eraser"===this.currentTool.elementId};d.prototype.handlePenDrawing=function(b,a){if(!this.isDrawingToolsActive()){var f=b.currentTarget.getBoundingClientRect();document.getElementById("pencil").dispatchEvent(new Event("click"));(a=
this.drawingInstances[a])&&a.pointerDown({pointerType:b.pointerType,button:b.button,buttons:b.buttons,offsetX:b.offsetX-f.left,offsetY:b.offsetY-f.top})}};d.isPen=function(b){return"pen"===b.pointerType};d.drawingLayerIdPrefix="drawingLayer";d.printContainerId="printContainer";return d}();e.DrawingManager=d})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){(function(e){var d=function(){function a(b){var a=b.elementId,c=b.pageNumber,d=b.width,h=b.height,l=b.backgroundColor;l=void 0===l?[255,255,255]:l;var m=b.lineWidth;m=void 0===m?5:m;var n=b.strokeColor;n=void 0===n?[0,0,0]:n;var p=b.disabled,q=b.showWarnings;q=void 0===q?!1:q;var r=b.scale;r=void 0===r?1:r;var t=b.cursorsFolder;this.requiredParam(b,"elementId");this.requiredParam(b,"width");this.requiredParam(b,"height");this.cursorProvider=new e.CursorProvider(t);this.elementId=a;this.pageNumber=
c;this.canvasNode=document.getElementById(this.elementId);if(this.canvasNode instanceof HTMLCanvasElement)this.canvas=this.canvasNode;else if(this.canvasNode instanceof HTMLElement)b=document.createElement("canvas"),this.canvasNode.appendChild(b),this.canvas=b;else throw Error("No element found with following id: "+this.elementId);this.context=this.canvas.getContext("2d");this.width=d;this.height=h;this.scale=r;this.undos=[];this.isDrawing=this.leftCanvasDrawing=!1;this.isDrawingModeEnabled=!0;this.lineWidth=
m;this.strokeColor=this.toValidColor(n);this.positions=[];this.oldPositions=[];this.isPenEraserButtonPressed=!1;this.previousLineWidth=0;this.previousStrokeColor=null;this.listenersList=this.isPointerEventsSupported()?["pointerDown","pointerMove","pointerLeave","pointerUp"]:["touchStart","touchMove","touchEnd"];this.allowedEvents=this.getAllowedEvents();this.dispatchEventsOnceEvery=this.redrawCounter=0;this.events={redrawEvent:new Event("cfd_redraw"),pointerUpEvent:new Event("cfd_pointerup"),pointerDownEvent:new Event("cfd_pointerdown"),
pointerEnterEvent:new Event("cfd_pointerenter"),pointerLeaveEvent:new Event("cfd_pointerleave"),touchStartEvent:new Event("cfd_touchstart"),touchEndEvent:new Event("cfd_touchend"),endDrawing:new Event("cfd_enddrawing"),penDrawingStartEvent:new Event("cfd_pendrawingstart"),penDrawingEndEvent:new Event("cfd_pendrawingend")};this.bindings={pointerDown:this.pointerDown.bind(this),pointerMove:this.pointerMove.bind(this),pointerLeave:this.pointerLeave.bind(this),pointerUp:this.pointerUp.bind(this),pointerUpDocument:this.pointerUpDocument.bind(this),
touchStart:this.touchStart.bind(this),touchMove:this.touchMove.bind(this),touchEnd:this.touchEnd.bind(this)};this.previousY=this.previousX=this.touchIdentifier=void 0;this.showWarnings=q;this.isNodeColorEqualCache={};this.setDimensions();this.setBackground(l);p||this.enableDrawingMode()}Object.defineProperty(a.prototype,"isErasingMode",{get:function(){for(var b=!0,a=0;a<this.strokeColor.length&&(b=this.strokeColor[a]===e.PencilSettings.Color.transparent[a],b);a++);return b},enumerable:!0,configurable:!0});
a.prototype.requiredParam=function(b,a){if(!b||!b[a])throw Error(a+" is required");};a.prototype.logWarning=function(b){this.showWarnings&&console.warn(b)};a.prototype.addListeners=function(){var b=this;this.listenersList.forEach(function(a){b.canvas.addEventListener(a.toLowerCase(),b.bindings[a])});document.addEventListener("pointerup",this.bindings.pointerUpDocument)};a.prototype.removeListeners=function(){var b=this;this.listenersList.forEach(function(a){b.canvas.removeEventListener(a.toLowerCase(),
b.bindings[a])});document.removeEventListener("pointerup",this.bindings.pointerUpDocument)};a.prototype.isPointerEventsSupported=function(){return"PointerEvent"in window};a.prototype.getAllowedEvents=function(){var b=[],a;for(a in e.AllowedEvents)b.push(a);return b};a.prototype.enableDrawingMode=function(){this.isDrawingModeEnabled=!0;this.addListeners();this.toggleCursor();return this.isDrawingModeEnabled};a.prototype.disableDrawingMode=function(){this.isDrawingModeEnabled=!1;this.removeListeners();
this.toggleCursor();return this.isDrawingModeEnabled};a.prototype.isPenEraser=function(b){return(b.buttons&a.penEraserButtonCode)===a.penEraserButtonCode};a.prototype.pointerDown=function(b){if(0===b.button||-1===b.button||this.isPenEraser(b))this.isPenEraser(b)&&(this.isPenEraserButtonPressed=!0,this.previousStrokeColor=this.strokeColor,this.previousLineWidth=this.lineWidth,this.setDrawingColor(e.PencilSettings.Color.transparent),this.setLineWidth(e.PencilSettings.Width.eraserWidth)),this.drawPoint(b.offsetX,
b.offsetY),e.DrawingManager.isPen(b)&&document.dispatchEvent(this.events.penDrawingStartEvent)};a.prototype.pointerMove=function(b){this.drawLine(b.offsetX,b.offsetY,b)};a.prototype.touchStart=function(b){if(0<b.changedTouches.length){var a=b.changedTouches[0],c=a.pageX;b=a.pageY;a=a.identifier;var d=this.canvas.getBoundingClientRect();c-=d.left;b-=d.top;this.touchIdentifier=a;this.drawPoint(c,b)}};a.prototype.touchMove=function(b){if(0<b.changedTouches.length){var a=b.changedTouches[0],c=a.pageX,
d=a.pageY;a=a.identifier;var e=this.canvas.getBoundingClientRect();c-=e.left;d-=e.top;a===this.touchIdentifier&&(this.previousX=c,this.previousY=d,this.drawLine(c,d,b))}};a.prototype.touchEnd=function(){this.handleEndDrawing();this.canvas.dispatchEvent(this.events.touchEndEvent)};a.prototype.pointerUp=function(b){this.handleEndDrawing();this.canvas.dispatchEvent(this.events.pointerUpEvent);this.isPenEraserButtonPressed&&(this.isPenEraserButtonPressed=!1,this.setDrawingColor(this.previousStrokeColor),
this.setLineWidth(this.previousLineWidth));e.DrawingManager.isPen(b)&&document.dispatchEvent(this.events.penDrawingEndEvent)};a.prototype.pointerUpDocument=function(){this.leftCanvasDrawing=!1};a.prototype.pointerLeave=function(){this.isDrawing&&(this.leftCanvasDrawing=!0);this.isDrawing=!1;this.handleEndDrawing();this.canvas.dispatchEvent(this.events.pointerLeaveEvent)};a.prototype.handleEndDrawing=function(){this.isDrawing=!1;var b=this.events.endDrawing;b.pageNumber=this.pageNumber;document.dispatchEvent(b);
this.context.strokeStyle=this.rgbaFromArray(this.strokeColor);this.context.fillStyle=this.rgbaFromArray(this.strokeColor);this.setContextLineWidth()};a.prototype.drawPoint=function(b,a){this.isDrawing=!0;this.storeDrawing(b,a,!1);this.canvas.dispatchEvent(this.events.pointerDownEvent);this.handleDrawing()};a.prototype.drawLine=function(b,a,c){this.leftCanvasDrawing&&(this.leftCanvasDrawing=!1,c instanceof PointerEvent?this.pointerDown(c):c instanceof TouchEvent&&this.touchEnd());this.isDrawing&&(this.storeDrawing(b,
a,!0),this.handleDrawing(this.dispatchEventsOnceEvery))};a.prototype.handleDrawing=function(b){this.context.lineJoin="round";var a=this.positions.slice().pop();a&&a[0]&&this.draw(a);b?0===this.redrawCounter%b&&this.canvas.dispatchEvent(this.events.redrawEvent):this.canvas.dispatchEvent(this.events.redrawEvent);this.undos=[];this.redrawCounter+=1};a.prototype.draw=function(b){var a=this;b.forEach(function(f,d){1!==a.scale&&(f=c.RectanglesTransformation.adjustPointToViewport(f,a.scale));f.strokeColor&&
(a.setDrawingColor(f.strokeColor),a.context.strokeStyle=a.rgbaFromArray(a.strokeColor),a.context.fillStyle=a.rgbaFromArray(a.strokeColor));f.lineWidth&&(a.setLineWidth(f.lineWidth),a.setContextLineWidth());a.context.beginPath();d?(d=c.RectanglesTransformation.adjustPointToViewport(b[d-1],a.scale),a.context.moveTo(d.x,d.y)):a.context.moveTo(f.x-1,f.y);a.context.lineTo(f.x,f.y);a.context.closePath();a.context.stroke();a.context.beginPath();a.context.arc(f.x,f.y,a.lineWidth*a.scale/2,0,2*Math.PI);a.context.fill()})};
a.prototype.toValidColor=function(b){if(Array.isArray(b)&&4===b.length)return b;if(Array.isArray(b)&&3===b.length)return b=b.slice(),b.push(255),b;this.logWarning("Color is not valid!\nIt must be an array with RGB values:  [0-255, 0-255, 0-255]");return[0,0,0,255]};a.prototype.rgbaFromArray=function(b){return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"};a.prototype.setDimensions=function(){this.canvas.height=this.height;this.canvas.width=this.width};a.prototype.toggleCursor=function(){this.canvas.style.cursor=
"auto";this.canvas.style.cursor=this.isDrawingModeEnabled?this.isErasingMode?this.cursorProvider.getEraseCursorStyle(this.strokeColor):this.cursorProvider.getDrawCursorStyle(this.strokeColor):"auto"};a.prototype.storeDrawing=function(b,a,d){d?this.positions[this.positions.length-1].push(c.RectanglesTransformation.adjustPointToDefaultScale({x:b,y:a},this.scale)):this.positions.push([c.RectanglesTransformation.adjustPointToDefaultScale({x:b,y:a,strokeColor:this.strokeColor,lineWidth:this.lineWidth},
this.scale)])};a.prototype.restoreCanvas=function(b){var a=this;b.forEach(function(b){b&&b[0]&&a.draw(b)})};a.prototype.setLineWidth=function(b){this.lineWidth=b};a.prototype.setContextLineWidth=function(){this.context.lineWidth=this.lineWidth*this.scale};a.prototype.setBackground=function(b,a){void 0===a&&(a=!0);if(b=this.toValidColor(b))a&&(this.backgroundColor=b),this.context.fillStyle=this.rgbaFromArray(b),this.context.fillRect(0,0,this.width,this.height)};a.prototype.setDrawingColor=function(b,
a){void 0===a&&(a=!1);this.context.globalCompositeOperation=1===b[3]?"destination-out":"source-over";this.setStrokeColor(b);a&&this.toggleCursor()};a.prototype.setStrokeColor=function(b){this.strokeColor=this.toValidColor(b)};a.prototype.clear=function(b){void 0===b&&(b=!0);this.context.clearRect(0,0,this.width,this.height);b&&(this.oldPositions=this.positions,this.positions=[]);this.backgroundColor&&this.setBackground(this.backgroundColor)};a.prototype.getDataToSave=function(){return this.positions};
a.prototype.getLastPoint=function(){var b=this.positions[this.positions.length-1];return b[b.length-1]};a.prototype.getPageNumber=function(){return this.pageNumber};a.prototype.restore=function(b,a){void 0===a&&(a=!0);this.clear(a);this.restoreCanvas(b);this.positions=b};a.prototype.undo=function(){var b=this.positions.pop();b&&0<b.length&&(this.undos.push(b),this.restore(this.positions,!1))};a.prototype.redo=function(){if(0<this.undos.length){var b=this.undos.pop();b&&0<b.length&&(this.positions.push(b),
this.restore(this.positions,!1))}else this.logWarning("There are no more redo left.")};a.prototype.getUndoRedoPointPosition=function(b){return b?this.positions[this.positions.length-1]:this.undos[this.undos.length-1]};a.prototype.logPositions=function(){console.log(this.positions)};a.penEraserButtonCode=32;return a}();e.FreeDrawing=d})(c.Drawing||(c.Drawing={}))})(Annotations||(Annotations={}));
(function(c){var e=CCL.CommonConstants,d=function(){return function(a,b){var f=this;this.urls=a;this.fileId=b;this.save=function(b){var a=new FormData;a.append("file",b,f.fileId);return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",f.urls.FileRepoUploadTokenUrl+"?FileId="+encodeURIComponent(f.fileId),!0);d.responseType="json";d.onload=function(){if(d.status===e.httpStatusCodes.ok){var g=d.response,k=new XMLHttpRequest;k.open("PUT",f.urls.FileRepoUrl+"/"+encodeURIComponent(f.fileId),
!0);k.setRequestHeader("Authorization","Bearer "+g);k.onload=function(){k.status===e.httpStatusCodes.ok?b():c("Cannot update pdf file in filerepo.")};k.send(a)}else c("Cannot get filerepo upload token.")};d.send()})}}}();c.FileRepoUpdater=d})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.settings=a;this.saveTimeoutMs=5E3;this.savePromise=null;this.save=function(){b.savePromise=b.savePromise.finally(function(){return c.AnnotationApp.pdfViewerInstance.getBlobData().then(function(a){b.fileRepoUpdater.save(a).then(function(a){b.saveInProgress=!1;b.toggleStatusMessages(!0)},function(a){b.saveInProgress=!1;CCL.CommonFunctions.jAjaxAlert(b.settings.Terms.ErrorCannotSaveFile,"",b.settings.Terms.Ok)})},function(a){CCL.CommonFunctions.jAjaxAlert(b.settings.Terms.ErrorCannotSaveFile,
"",b.settings.Terms.Ok)})})};this.attachEventListeners=function(){var a=c.AnnotationApp.pdfViewerInstance;a&&a.pdfDocument&&a.pdfDocument.annotationStorage&&(a.pdfDocument.annotationStorage.onSetValue=b.onSetValueFunction)};this.onSetValueFunction=function(){b.saveInProgress=!0;b.toggleStatusMessages(!1);b.timeoutId&&clearTimeout(b.timeoutId);b.timeoutId=setTimeout(function(){clearTimeout(b.timeoutId);b.timeoutId=null;b.save()},b.saveTimeoutMs)};this.saveInProgress=!1;this.timeoutId=null;this.savePromise=
Promise.resolve();this.fileRepoUpdater=new c.FileRepoUpdater(a.Urls,a.FileRepoId);this.statusMessageSaving=document.getElementById("document-status-saving");this.statusMessageSaved=document.getElementById("document-status-saved");document.addEventListener(c.AnnotationApp.PdfViewerInitializedEventType,function(){c.AnnotationApp.pdfViewerInstance.eventBus.on("documentloaded",b.attachEventListeners)})}d.prototype.toggleStatusMessages=function(a){a=a&&!this.saveInProgress&&null==this.timeoutId;this.statusMessageSaving.style.display=
a?"none":"";this.statusMessageSaved.style.display=a?"":"none"};return d}();c.FillableFormsManager=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.Get=function(a){return{"co-FR":"fr","da-DK":"da","de-DE":"de","en-GB":"en-GB","en-US":"en-US","es-ES":"es-ES","fi-FI":"fi","fr-FR":"fr","it-IT":"it","lt-LT":"lt","ms-BN":"en-GB","nb-NO":"nb-NO","nl-NL":"nl","nn-NO":"nn-NO","pl-PL":"pl","pt-BR":"pt-BR","pt-PT":"pt-PT","sv-SE":"sv-SE","tr-TR":"tr","zh-CN":"zh-CN","uk-UA":"uk","ru-RU":"ru","ca-ES":"ca"}[a]};return c}();c.LocaleProvider=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(a,b){var f=this;this.loadAllAnnotations=function(b){if(f.allAnnotationsLoadCompleted)return Promise.resolve(b);if(f.allAnnotationsLoadStarted)return f.loadAllAnnotationsPromise.then(function(){return b});f.allAnnotationsLoadStarted=!0;f.loadAllAnnotationsPromise=new Promise(function(a){f.storage.load([],!0,function(){f.allAnnotationsLoadCompleted=!0;a(b)})});return f.loadAllAnnotationsPromise};this.loadAnnotationFromCache=function(b){return[f.storage.getByPageFromCache(b),
b]};this.renderDrawingAndReturnCanvas=function(b){var a=b[0];b=b[1];if(!a)return null;for(var c=0;c<a.length;c++){var d=a[c];2===d.Type&&f.drawingManager.renderDrawing(JSON.parse(d.Structure),b)}return f.drawingManager.getCanvasByPage(b)};this.storage=a;this.drawingManager=b;this.allAnnotationsLoadCompleted=this.allAnnotationsLoadStarted=!1;window[c.printManagerInstanceName]=this}c.prototype.getAnnotationCanvasByPage=function(a,b,f){var d=this.drawingManager.getCanvasByPage(a);if(d)return Promise.resolve(d);
this.drawingManager.renderLayer(a,c.defaultScale,b,f);return this.loadAllAnnotations(a).then(this.loadAnnotationFromCache).then(this.renderDrawingAndReturnCanvas)};c.printManagerInstanceName="AnnotationPrintManager";c.defaultScale=1;return c}();c.PrintManager=e})(Annotations||(Annotations={}));var Assignment;
(function(c){(function(c){var d=function(){function a(b){var a=this;this.button=b;CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.replyToExtensionFrameWhenTopFrameExists,function(){a.button.show().on("click",function(){return a.openGroupChat()})});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.askExtensionParentFrameWhetherTopFrameExists))}a.prototype.openGroupChat=
function(){var b={collaborationId:this.button.attr("data-collaborationId")};CCL.CommonFunctions.makePostMessageCallWithData(window.top,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.openGroupChat),b);return!1};return a}();c.GroupChatButton=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){c=c.AllInOneGraderActionAfterClose||(c.AllInOneGraderActionAfterClose={});c[c.RefreshPage=0]="RefreshPage";c[c.SendPostMessage=1]="SendPostMessage"})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b,f){var d=this;this.answerId=a;this.plagiarismApiUrl=b;this.settings=f;this.poolingInterval=2E4;this.poolingMaxAttempts=60;this.attachUpdaterWithInitialState=function(b){d.updateAnswerPlagiarismStatus(b);d.updateFilesPlagiarismStatus(b);d.needToKeepPlagiarismStatusUpdating(b)&&d.updatePlagiarismLinkWithTimeout()};this.attachUpdater=function(){d.updatePlagiarismLinkWithTimeout()};this.removeUpdater=function(){d.clearPlagiarismReportLinkUpdateTimeout()};this.hidePlagiarismStatuses=
function(){$("."+d.answerPlagiarismPlaceholderCssClass).html("");$("."+d.filePlagiarismPlaceholderCssClass).html("")};this.removeUpdater();this.answerPlagiarismPlaceholderCssClass=c.CssClasses.Grader.AnswerPlagiarismReportPlaceholder;this.filePlagiarismPlaceholderCssClass=c.CssClasses.Grader.FilePlagiarismReportPlaceholder;this.answerAndFilePlaceholderSelector="."+this.answerPlagiarismPlaceholderCssClass+", ."+this.filePlagiarismPlaceholderCssClass;$(document).off("click",this.answerAndFilePlaceholderSelector);
if(this.settings&&this.settings.IsPlagiarismReportsEditable)$(document).on("click",this.answerAndFilePlaceholderSelector,function(){d.removeUpdater();d.attachUpdater()});$(document).off(c.Constants.Events.PlagiarismStatusChanged).on(c.Constants.Events.PlagiarismStatusChanged,function(){return d.updatePlagiarismLink(0,!0)})}d.prototype.updatePlagiarismLink=function(a,b){var f=this;void 0===a&&(a=0);void 0===b&&(b=!1);CCL.CommonFunctions.safeAjax({url:this.plagiarismApiUrl+"?answerId="+this.answerId,
type:"GET",dataType:"json"}).done(function(c){f.updateAnswerPlagiarismStatus(c);f.updateFilesPlagiarismStatus(c);f.needToKeepPlagiarismStatusUpdating(c)&&a<f.poolingMaxAttempts&&!b&&f.updatePlagiarismLinkWithTimeout(++a)}).always(function(){})};d.prototype.needToKeepPlagiarismStatusUpdating=function(a){return a&&a.Success&&(a.AnswerStatus||a.FileStatusList&&0<a.FileStatusList.length)};d.prototype.updatePlagiarismLinkWithTimeout=function(a){var b=this;void 0===a&&(a=0);this.removeUpdater();d.plagiarismReportLinkUpdateTimeout=
setTimeout(function(){b.updatePlagiarismLink(a)},this.poolingInterval)};d.prototype.clearPlagiarismReportLinkUpdateTimeout=function(){d.plagiarismReportLinkUpdateTimeout&&clearTimeout(d.plagiarismReportLinkUpdateTimeout)};d.prototype.updateAnswerPlagiarismStatus=function(a){a&&a.Success&&a.AnswerStatus&&a.AnswerStatus.ReportLinkHtml&&$("."+this.answerPlagiarismPlaceholderCssClass+"["+c.Constants.DataAttributes.AnswerId+'="'+a.AnswerStatus.Id+'"]').html(a.AnswerStatus.ReportLinkHtml)};d.prototype.updateFilesPlagiarismStatus=
function(a){var b=this;a&&a.Success&&a.FileStatusList&&a.FileStatusList.forEach(function(a){$("."+b.filePlagiarismPlaceholderCssClass+"["+c.Constants.DataAttributes.FileId+'="'+a.Id+'"]').html(a.ReportLinkHtml)})};return d}();c.PlagiarismStatusUpdater=e})(Assignment||(Assignment={}));var Tools;(function(c){var e=function(){function c(){}c.isTouchDevice=function(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints};return c}();c.Misc=e})(Tools||(Tools={}));
(function(c){var e=function(){function c(){}c.loadScript=function(a,b){void 0===b&&(b=document.head);var f=document.createElement("script");b.appendChild(f);f.src=a;return f};c.supportsES6Modules=function(){return"noModule"in HTMLScriptElement.prototype};c.supportsNullishCoalescing=function(){try{return eval("let a; a ?? 0"),!0}catch(a){return!1}};return c}();c.ScriptLoader=e})(Tools||(Tools={}));
(function(c){var e=function(){function d(){}d.prototype.createToken=function(){this.token=new c.CancellationToken;this.cancelFunc=this.token.init();return this.token};d.prototype.cancel=function(){this.cancelFunc&&"function"===typeof this.cancelFunc&&this.cancelFunc()};return d}();c.CancellationTokenSource=e})(Tools||(Tools={}));
(function(c){var e=function(){function c(){}c.attachHandlerOnContainer=function(a){var b=this;a.find("."+Assignment.CssClasses.ExpandableSection.Arrow).attr("aria-expanded","true");a.find("."+Assignment.CssClasses.ExpandableSection.Section).attr("aria-hidden","false");a.on("click","."+Assignment.CssClasses.ExpandableSection.Arrow,function(f){return b.toggleSection(f,a)});a.keydown(function(f){return b.keyHandler(f,a)})};c.toggleSection=function(a,b){var f=$(a.target).attr("aria-controls"),c="true"===
$(a.target).attr("aria-expanded");b=b.find("#"+f);c?($(a.target).attr("aria-expanded","false"),b.attr("aria-hidden","true").hide(200)):($(a.target).attr("aria-expanded","true"),b.attr("aria-hidden","false").show(200))};c.keyHandler=function(a,b){$(a.target).hasClass(Assignment.CssClasses.ExpandableSection.Arrow)&&(a.which===CCL.CommonConstants.keyCodes.space?(this.toggleSection(a,b),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.arrowUp||a.which===CCL.CommonConstants.keyCodes.arrowDown?
(this.getNextExpander(a,b).focus(),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.home?(b.find("."+Assignment.CssClasses.ExpandableSection.Arrow).first().focus(),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.end&&(b.find("."+Assignment.CssClasses.ExpandableSection.Arrow).last().focus(),a.preventDefault()))};c.getNextExpander=function(a,b){b=b.find("."+Assignment.CssClasses.ExpandableSection.Arrow);var f=b.index(a.target),c=b.length;return b.get((f+c+(a.which===CCL.CommonConstants.keyCodes.arrowUp?
-1:1))%c)};return c}();c.ExpandableSection=e})(Tools||(Tools={}));
(function(c){(function(a){a[a.CustomCancel=0]="CustomCancel";a[a.NewRequest=1]="NewRequest";a[a.AjaxPostError=2]="AjaxPostError"})(c.RequestCancelReasons||(c.RequestCancelReasons={}));var e=c.RequestCancelReasons,d=function(){function a(b,a){void 0===a&&(a=1E3);this.requestUrl=b;this.delayBetweenRequests=a}a.prototype.load=function(b,a){var f=this;this.cancelLastRequest(e.NewRequest);var c=$.Deferred();this.currentLoadingDeferred=c;this.isQuicklyRequest?this.sendRequestTimeout=setTimeout(function(){f.sendRequestTimeout=
void 0;a.isCanceled?c.reject(e.CustomCancel):f.sendRequest(b,c,a)},this.delayBetweenRequests):this.sendRequest(b,c,a);this.isQuicklyRequest=!0;this.quicklyNavigateTimeout=setTimeout(function(){f.isQuicklyRequest=!1;f.quicklyNavigateTimeout=void 0},this.delayBetweenRequests);return c.promise()};a.prototype.sendRequest=function(b,a,c){CCL.CommonFunctions.safeAjaxPost({url:this.requestUrl,data:b,dataType:"JSON"}).done(function(b){c.isCanceled?a.reject(e.CustomCancel):a.resolve(b)}).fail(function(b,f,
d){c.isCanceled?a.reject(e.CustomCancel):a.reject(e.AjaxPostError,b,f,d)})};a.prototype.cancelLastRequest=function(b){this.quicklyNavigateTimeout&&(clearTimeout(this.quicklyNavigateTimeout),this.quicklyNavigateTimeout=void 0);this.sendRequestTimeout&&(clearTimeout(this.sendRequestTimeout),this.sendRequestTimeout=void 0);this.currentLoadingDeferred&&"pending"===this.currentLoadingDeferred.state()&&this.currentLoadingDeferred.reject(b)};return a}();c.RequestLimiter=d})(Tools||(Tools={}));
(function(c){var e=function(){return function(a,b,f){this.key=a;this.value=b;this.createdDate=f}}();c.JsDataCache=e;var d=function(){return function(){}}();c.JsDataCacheWorkerOptions=d;d=function(){function a(b){this.cache=[];this.expiryTime=b.expiryTime;this.cacheSize=b.cacheSize}a.prototype.getValue=function(b){for(var a=null,c=0;c<this.cache.length;c++)if(this.cache[c].key===b){a=this.cache[c];break}return a?(new Date).valueOf()-a.createdDate.valueOf()>this.expiryTime?(this.cache.splice(c,1),null):
a.value:null};a.prototype.addData=function(b,a){this.cache.length>this.cacheSize&&this.cache.shift();b=new e(b,a,new Date);this.cache.push(b)};a.prototype.clear=function(){this.cache.splice(0)};return a}();c.JsDataCacheWorker=d})(Tools||(Tools={}));
(function(c){var e=function(){function c(a,b){this.url=a;this.headersListUpdatedCallback=b;this.pagesCache=new Tools.JsDataCacheWorker({expiryTime:3E5,cacheSize:4})}c.prototype.initSingleMode=function(a){this.virtualCount=1;this.currentUserIndex=0;this.nextHeadersList=this.previousHeadersList=null;this.currentUserId=a.UserId;this.currentHeadersList=[];this.currentHeadersList.push(a)};c.prototype.init=function(a,b,f,c){var d=this;this.pageIndex=a;this.pageSize=b;this.currentUserId=f;this.nextHeadersList=
this.previousHeadersList=this.currentHeadersList=null;var g=$.Deferred();c?(this.currentHeadersList=c.HeaderViewModels,this.pagesCache.addData(a,c.HeaderViewModels),this.virtualCount=c.VirtualCount,this.updateCurrentUserIndex(),g.resolve(this.getCurrentHeader()),this.loadHeadersIfNeed()):this.loadHeadersPage(a).done(function(b){d.currentHeadersList=b;d.updateCurrentUserIndex();g.resolve(d.getCurrentHeader());d.loadHeadersIfNeed()});return g.promise()};c.prototype.clear=function(){this.virtualCount=
this.pageSize=this.pageIndex=0;this.currentUserIndex=this.currentUserId=void 0;this.nextHeadersList=this.previousHeadersList=this.currentHeadersList=null;this.pagesCache.clear()};c.prototype.getCurrentHeader=function(){return this.canRefresh?this.currentHeadersList[this.currentUserIndex]:null};c.prototype.getNextHeader=function(){if(!this.canNextNavigate())return null;this.currentUserIndex++;this.currentUserIndex>this.currentHeadersList.length-1&&(this.previousHeadersList=this.currentHeadersList,
this.currentHeadersList=this.nextHeadersList,this.nextHeadersList=null,this.pageIndex=this.getNextPageIndex(),this.currentUserIndex=0);var a=this.getCurrentHeader();this.currentUserId=a.UserId;this.loadHeadersIfNeed();return a};c.prototype.getPreviousHeader=function(){if(!this.canPreviousNavigate())return null;this.currentUserIndex--;0>this.currentUserIndex&&(this.nextHeadersList=this.currentHeadersList,this.currentHeadersList=this.previousHeadersList,this.previousHeadersList=null,this.pageIndex=
this.getPreviousPageIndex(),this.currentUserIndex=this.currentHeadersList.length-1);var a=this.getCurrentHeader();this.currentUserId=a.UserId;this.loadHeadersIfNeed();return a};Object.defineProperty(c.prototype,"canRefresh",{get:function(){return void 0!==this.currentUserIndex&&this.currentHeadersList&&this.currentHeadersList[this.currentUserIndex]?!0:!1},enumerable:!0,configurable:!0});c.prototype.canNextNavigate=function(){if(1>=this.virtualCount)return!1;if(this.currentUserIndex<this.currentHeadersList.length-
1){if(this.currentHeadersList)return!0}else if(this.nextHeadersList&&!this.isNextPageLoading&&!this.isPreviousPageLoading)return!0;return!1};c.prototype.canPreviousNavigate=function(){if(1>=this.virtualCount)return!1;if(0<this.currentUserIndex){if(this.currentHeadersList)return!0}else if(this.previousHeadersList&&!this.isNextPageLoading&&!this.isPreviousPageLoading)return!0;return!1};c.prototype.loadHeadersIfNeed=function(){this.checkToNeedLoadNextPage()&&this.loadNextPage();this.checkToNeedLoadPreviousPage()&&
this.loadPreviousPage()};c.prototype.checkToNeedLoadNextPage=function(){return!this.isNextPageLoading&&this.currentUserIndex>this.currentHeadersList.length-4&&!this.nextHeadersList?!0:!1};c.prototype.checkToNeedLoadPreviousPage=function(){return!this.isPreviousPageLoading&&3>this.currentUserIndex&&!this.previousHeadersList?!0:!1};c.prototype.loadNextPage=function(){var a=this;if(!this.isNextPageLoading){this.isNextPageLoading=!0;var b=this.getNextPageIndex();this.loadHeadersPage(b).done(function(b){a.nextHeadersList=
b}).always(function(){a.isNextPageLoading=!1;a.sendPageUpdatesNotification()})}};c.prototype.loadPreviousPage=function(){var a=this;if(!this.isPreviousPageLoading){this.isPreviousPageLoading=!0;var b=this.getPreviousPageIndex();this.loadHeadersPage(b).done(function(b){a.previousHeadersList=b}).always(function(){a.isPreviousPageLoading=!1;a.sendPageUpdatesNotification()})}};c.prototype.getPagesCount=function(){return Math.ceil(this.virtualCount/this.pageSize)};c.prototype.getNextPageIndex=function(){return this.pageIndex<
this.getPagesCount()-1?this.pageIndex+1:0};c.prototype.getPreviousPageIndex=function(){return 0<this.pageIndex?this.pageIndex-1:this.getPagesCount()-1};c.prototype.loadHeadersPage=function(a){var b=this,f=$.Deferred(),c=this.pagesCache.getValue(a);if(c)return f.resolve(c),f.promise();CCL.CommonFunctions.safeAjaxPost({url:this.url,data:{pageIndex:a,pageSize:this.pageSize},dataType:"JSON"}).done(function(c){b.virtualCount=c.VirtualCount;b.pagesCache.addData(a,c.HeaderViewModels);f.resolve(c.HeaderViewModels)}).fail(function(b,
a,c){f.reject(b,a,c);console.error("Error loading grader headers")});return f.promise()};c.prototype.updateCurrentUserIndex=function(){for(var a=0;a<this.currentHeadersList.length;a++)if(this.currentHeadersList[a].UserId===this.currentUserId){this.currentUserIndex=a;return}console.error("Current user not found in current headers page")};c.prototype.sendPageUpdatesNotification=function(){this.headersListUpdatedCallback&&"function"===typeof this.headersListUpdatedCallback&&this.headersListUpdatedCallback()};
return c}();c.AllInOneGraderHeadersLoader=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b,f,d){var g=this;this.$navigatePreviousButton=b;this.$navigateNextButton=f;this.headerRenderer=d;this.headersLoader=new c.AllInOneGraderHeadersLoader(a.HeadersPageUrl,function(){g.waitForUpdateNavigationStatus&&(g.waitForUpdateNavigationStatus=!1,g.updateNavigationButtonAvailableStatus())});this.toggleNextNavigationButton(!1);this.togglePreviousNavigationButton(!1);this.requestLimiter=new Tools.RequestLimiter(a.AnswerUrl,1E3)}d.prototype.init=function(a,
b,f){return null!=a.PageIndex&&void 0!=a.PageIndex&&null!=a.PageSize&&void 0!=a.PageSize&&!isNaN(a.PageSize)&&!isNaN(a.PageIndex)&&0<a.PageSize?this.initCommonMode(a,b,f):this.initSingleMode(a.UserId,b)};d.prototype.close=function(){this.headerRenderer.clearHeader();this.headersLoader.clear()};d.prototype.refreshCurrent=function(a){if(!this.canRefresh)return null;var b=this.headersLoader.getCurrentHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);return a};d.prototype.goToNext=
function(a){if(!this.canNextNavigate)return null;this.toggleNextNavigationButton(!1);var b=this.headersLoader.getNextHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);this.updateNavigationButtonAvailableStatus();return a};d.prototype.goToPrevious=function(a){if(!this.canPreviousNavigate)return null;this.togglePreviousNavigationButton(!1);var b=this.headersLoader.getPreviousHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);this.updateNavigationButtonAvailableStatus();
return a};Object.defineProperty(d.prototype,"canRefresh",{get:function(){return this.isRefreshAvailable&&this.headersLoader.canRefresh},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canNextNavigate",{get:function(){return this.isNextNavigateAvailable},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canPreviousNavigate",{get:function(){return this.isPreviousNavigateAvailable},enumerable:!0,configurable:!0});d.prototype.initSingleMode=function(a,b){var f=this;
this.$navigateNextButton.hide();this.$navigatePreviousButton.hide();a=this.load(a,b,!0);a.done(function(b){b&&b.HeaderViewModel&&(f.headersLoader.initSingleMode(b.HeaderViewModel),f.headerRenderer.setHeader(b.HeaderViewModel.PersonReferenceList))});return a};d.prototype.initCommonMode=function(a,b,f){var c=this;this.headersLoader.init(+a.PageIndex,+a.PageSize,a.UserId,f).done(function(b){c.headerRenderer.setHeader(b.PersonReferenceList);c.updateNavigationButtonAvailableStatus()});return this.load(a.UserId,
b)};d.prototype.load=function(a,b,f){var c=this;void 0===f&&(f=!1);this.isRefreshAvailable=!1;a=this.requestLimiter.load({userId:a,isSingleMode:f},b);a.always(function(){c.isRefreshAvailable=!0});return a};d.prototype.updateNavigationButtonAvailableStatus=function(){var a=this.headersLoader.canNextNavigate(),b=this.headersLoader.canPreviousNavigate();this.toggleNextNavigationButton(a);this.togglePreviousNavigationButton(b);a&&b||(this.waitForUpdateNavigationStatus=!0)};d.prototype.toggleNextNavigationButton=
function(a){this.isNextNavigateAvailable=a;this.$navigateNextButton.toggleClass(c.CssClasses.Grader.DisabledNavigationButtons,!a)};d.prototype.togglePreviousNavigationButton=function(a){this.isPreviousNavigateAvailable=a;this.$navigatePreviousButton.toggleClass(c.CssClasses.Grader.DisabledNavigationButtons,!a)};return d}();c.AllInOneGraderDataLoader=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){this.$headerContainer=a;this.headerSettings=b}d.prototype.clearHeader=function(){this.printTitle="";this.$headerContainer.empty();this.showMoreActionMenu&&(this.showMoreActionMenu=void 0)};d.prototype.setHeader=function(a){this.clearHeader();1<a.length?(this.printTitle=this.headerSettings.GroupTerm,this.setHeaderWithPersonsList(a)):0<a.length&&(a=a[0],this.printTitle=a.FullName,this.setHeaderWithOnePerson(a))};d.prototype.getPrintTitle=function(){return this.printTitle};
d.prototype.setHeaderWithOnePerson=function(a){this.getPersonReference(a,!1,!0,!0).appendTo(this.$headerContainer)};d.prototype.setHeaderWithPersonsList=function(a){for(var b=$("<div>").addClass(this.headerSettings.ProfilePicturesContainerClass),f=$("<ul>").addClass(this.headerSettings.PersonReferenceListClass),c=null,d=0;d<a.length;d++){var e=a[d];if(d<this.headerSettings.MaxItemsShown)b.append(this.getProfilePicture(e)),$("<li>").addClass(this.headerSettings.PersonReferenceListItemClass).append(this.getPersonReference(e,
!0)).appendTo(f);else{c=this.getShowMoreLink(a.slice(this.headerSettings.MaxItemsShown));break}}b.appendTo(this.$headerContainer);f.appendTo(this.$headerContainer);c&&c.appendTo(this.$headerContainer)};d.prototype.getShowMoreLink=function(a){var b=this,f=$("<a>").prop("href","javascript:void(0);").append($("<span>").html(this.headerSettings.ShowMoreLinkTextTemplate?this.headerSettings.ShowMoreLinkTextTemplate.replace("{0}",a.length.toString()):"").addClass("h-mrl5")),d=[];a.forEach(function(a){var f=
b.getProfilePictureWithContainer(a).get(0).outerHTML;f+=b.getPersonReference(a,!1,!1).get(0).outerHTML;a=new CCL.ActionMenuItem(f,a.PersonId.toString(),function(b){b=parseInt(b.Id);c.Base.requestOpenProfileCard(b)});d.push(a)});a=new CCL.ActionMenuSettings;a.MenuZIndex=c.Constants.AllInOneGraderActionMenuZIndex;this.showMoreActionMenu=new CCL.ActionMenu(f,d,a);return f};d.prototype.getPersonReference=function(a,b,f,c){void 0===b&&(b=!1);void 0===f&&(f=!0);void 0===c&&(c=!1);b=$("<span>").addClass(this.headerSettings.PersonReferenceClass).html(b&&
!a.HideDetails?CCL.CommonFunctions.htmlEncode(a.FirstName):CCL.CommonFunctions.htmlEncode(a.FullName));var d=$("<span>").addClass(this.headerSettings.PersonReferenceContainerClass).addClass(a.ContainerCssClass),g;c&&(g=this.getProfilePicture(a));!a.HideDetails&&f?(a=this.getProfileLink(a,this.headerSettings.HeaderPersonReferenceLinkClass,this.headerSettings.LinkTitleTextTemplate),g&&a.append(g),a.append(b).appendTo(d)):(g&&d.append(g),b.appendTo(d));return d};d.prototype.getProfilePictureWithContainer=
function(a){var b=this.getProfilePicture(a);a=$("<span>").addClass(this.headerSettings.ProfilePictureContainerClass).addClass(a.ContainerCssClass);b.appendTo(a);return a};d.prototype.getProfilePicture=function(a){return $("<img>").prop("alt","").attr("src",a.ProfilePictureUrl).addClass(this.headerSettings.ProfilePictureClass)};d.prototype.getProfileLink=function(a,b,f){b=$("<button type='button'>").attr("data-personid",a.PersonId).addClass(b);f&&(a=f.replace("{0}",a.FullName),b.attr("aria-label",
a));return b};return d}();c.AllInOneGraderHeaderRenderer=e})(Assignment||(Assignment={}));
(function(c){var e;(function(a){a[a.Next=0]="Next";a[a.Previous=1]="Previous"})(e||(e={}));var d=function(){function a(b){var a=this;this.hasChanges=this.isDialogOpen=!1;this.beforePrintAnswer=function(){if(a.isDialogOpen){var b=$("body");if(!b.hasClass(a.settings.CssClasses.PrintMode)){document.title=a.headerRenderer.getPrintTitle();var f=$("."+a.settings.CssClasses.AnswerContent+":visible"),c=$("."+a.settings.CssClasses.FileViewerContent+":visible");b.append(f).append(c).addClass(a.settings.CssClasses.PrintMode)}}};
this.afterPrintAnswer=function(){if(a.isDialogOpen){var b=$("body");b.removeClass(a.settings.CssClasses.PrintMode);var f=b.children("."+a.settings.CssClasses.AnswerContent);b=b.children("."+a.settings.CssClasses.FileViewerContent);$("#"+a.settings.AnswerContainerId).prepend(f);$("."+a.settings.CssClasses.FileViewerContainer).append(b)}};this.settings=b;window[c.Constants.ClientInstanceNames.AllInOneGrader]||(window[c.Constants.ClientInstanceNames.AllInOneGrader]=this);this.dialog=CCL.FullScreenDialog.getInstance();
this.$dialogContent=this.dialog.$dialog;this.$navigateNextBtn=this.$dialogContent.find("#"+c.Constants.ClientIds.AllInOneGraderHeaderNext);this.$navigatePreviousBtn=this.$dialogContent.find("#"+c.Constants.ClientIds.AllInOneGraderHeaderPrevious);this.informationFeedback=new c.InformationFeedbackWrapper("#"+c.Constants.ClientIds.AllInOneGraderContent);this.forgotToSave=new c.ForgotToSave(b.Terms.ForgotToSaveTermsModel,function(){return a.currentAssessment&&a.isDialogOpen?JSON.stringify(a.currentAssessment.initValues):
null},function(){return a.currentAssessment&&a.isDialogOpen?JSON.stringify(a.currentAssessment.getDataToSave()):null});this.forgotToSave.bindBrowserEvents();b=$("."+c.CssClasses.Grader.HeaderPersonReferenceContainer);this.headerRenderer=new c.AllInOneGraderHeaderRenderer(b,this.settings.HeaderSettings);this.dataLoader=new c.AllInOneGraderDataLoader(this.settings.Urls,this.$navigatePreviousBtn,this.$navigateNextBtn,this.headerRenderer);this.cancellationTokenSource=new Tools.CancellationTokenSource;
this.registerHandlers();c.Master.beforePrintCallback(this.beforePrintAnswer);c.Master.afterPrintCallback(this.afterPrintAnswer)}a.getInstance=function(){return window[c.Constants.ClientInstanceNames.AllInOneGrader]};a.prototype.clear=function(){this.currentAssessment&&this.currentAssessment.clear();var b=c.Controls.Answer.getInstance();b&&b.clear();document.dispatchEvent(new Event(c.Constants.Events.AnswerViewingFinished));this.headerRenderer.clearHeader();this.teacherNotesClientId&&(CCL.CommentModule[this.teacherNotesClientId]=
!1);this.commentsClientId&&(CCL.CommentModule[this.commentsClientId]=!1)};a.prototype.isOpen=function(){return this.isDialogOpen};a.prototype.open=function(b,a){var f=this;this.dialog.openDialogWithContent("");var d=this.loadingStarted();this.actionAfterClose=b.ActionAfterClose?b.ActionAfterClose:c.AllInOneGraderActionAfterClose.RefreshPage;this.dataLoader.init(b,d,a).done(function(b){f.isDialogOpen=!0;f.hasChanges=!1;f.cancelableInit(b,d)}).fail(function(b){f.loadingFail(b)})};a.prototype.onClose=
function(){this.cancellationTokenSource.cancel();this.isDialogOpen=!1;this.clear();this.dataLoader.close();$(document.body).empty();$("<div>").addClass(c.CssClasses.Grader.LoadingIndicator).appendTo(document.body);switch(this.actionAfterClose){case c.AllInOneGraderActionAfterClose.SendPostMessage:CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.backToPreviousPage));break;default:var b=this.getCurrentPageUrl();document.location.replace(b)}};
a.prototype.close=function(b,a){void 0===a&&(a=!1);this.dialog.closeDialog();b&&(b=this.getCurrentPageUrl(),a&&(b=CCL.CommonFunctions.setQueryStringParameter(b,c.Constants.RequestParams.IsLastAnswerAssessed,(!0).toString())),document.location.replace(b))};a.prototype.getCurrentPageUrl=function(){var b=window.location.href,a=b.lastIndexOf("#");0<a&&(b=b.substring(0,a));return b=CCL.CommonFunctions.setQueryStringParameter(b,"OpenGraderWithUserId","")};a.prototype.updateComments=function(b,a){this.commentsClientId=
b;this.teacherNotesClientId=a;this.commentsClientId&&"string"===typeof this.commentsClientId&&(b=$("#"+this.commentsClientId).getCommentModuleObject())&&!b.isDataSourceFetchedAtLeastOnce()&&b.loadAndShow();this.teacherNotesClientId&&"string"===typeof this.teacherNotesClientId&&(b=$("#"+this.teacherNotesClientId).getCommentModuleObject())&&!b.isDataSourceFetchedAtLeastOnce()&&b.loadAndShow()};a.waitForAnswerOrFile=function(){var b=$("."+c.CssClasses.Grader.AnswerContainer);$("."+c.CssClasses.Grader.AnswerOrFileViewer).hide();
a.createLoadingIndicator(c.Constants.ClientIds.AnswerOrFileLoadingIndicator).appendTo(b)};a.endWaitForAnswerOrFile=function(){$("."+c.CssClasses.Grader.AnswerContainer).find("#"+c.Constants.ClientIds.AnswerOrFileLoadingIndicator).remove();$("."+c.CssClasses.Grader.AnswerOrFileViewer).show()};a.prototype.cancelableInit=function(b,a){a.isCanceled||(b.IsLastAnswerAssessed?this.close(!0,!0):(this.dialog.updateContentWithHtmlString(b.ContentHtml),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$dialogContent),
a.isCanceled||(b.AssessmentSettingsModel&&(b.AnswerControlSettingsModel.ShowAnswerFileDirectly?c.Controls.Answer.loadViewer(b.AnswerControlSettingsModel.FileUrlForOpenDirectly):(this.currentAnswer=new c.Controls.Answer(b.AnswerControlSettingsModel),b.AnswerControlSettingsModel.ShowPeerAssessment&&(this.currentAnswer.peerAssessmentGridManager=new c.PeerAssessmentGridManager(b.AnswerControlSettingsModel.PeerAssessmentGridManagerSettings))),this.currentAssessment=new c.Assessment(b.AssessmentSettingsModel)),
a.isCanceled||(this.updateComments(b.CommentsClientId,b.TeacherNotesClientId),this.loadingComplete(),window.loadIframelyEmbedJs&&window.loadIframelyEmbedJs()))))};a.prototype.registerHandlers=function(){var b=this;$(this.dialog).on(CCL.FullScreenDialog.onCloseEvent,function(){return b.onClose()});$(document).on(CCL.FullScreenDialog.onCloseCancelableEvent,function(a){a.preventDefault();b.currentAssessment&&b.currentAssessment.isFeedbackAreaInFocus&&b.currentAssessment.updateInlineEditorText();b.forgotToSaveHandler().done(function(){a.originalEvent.detail.resolve()})});
$(document).on(c.Constants.Events.AssessmentSaved,function(){b.hasChanges=!0;b.informationFeedback.show(b.settings.Terms.AssessmentSaved).hide(5E3)});$(document).on(c.Constants.Events.PlagiarismRequested,function(){b.hasChanges=!0;b.informationFeedback.show(b.settings.Terms.PlagiarismReportRequested).hide(5E3)});$(document).on(c.Constants.Events.PlagiarismRequestCancel,function(){b.hasChanges=!0});$(document).on(c.Constants.Events.AnswersGridDataChanged,function(){b.hasChanges=!0});$(document).on(c.Constants.Events.AssessmentSaveFailed,
function(a,c,d){a=c&&0===c.status?b.settings.Terms.NoInternetConnection:"";c&&!0===c.isValidationError||("function"===typeof d?b.informationFeedback.showWithButton(b.settings.Terms.SavingAssessmentFailed,a,b.settings.Terms.TryAgain,d):b.informationFeedback.show(b.settings.Terms.SavingAssessmentFailed,a))});this.$dialogContent.on("click","#"+c.Constants.ClientIds.AllInOneGraderHeaderNext,function(){return b.navigateTo(e.Next)});this.$dialogContent.on("click","#"+c.Constants.ClientIds.AllInOneGraderHeaderPrevious,
function(){return b.navigateTo(e.Previous)});this.$dialogContent.on("click","."+c.CssClasses.Grader.ShowSidebarButton+", ."+c.CssClasses.Grader.HideSidebarButton,function(){b.$dialogContent.find("."+c.CssClasses.Grader.Content).toggleClass("hideAnswer")});$(document).on(c.Constants.Events.AnswerRefresh,function(){return b.refreshGraderWithoutConfirm()});$(window).keydown(function(a){return b.windowKeyHandler(a)});this.$dialogContent.find("."+CCL.CommonCssClasses.FullScreenDialog.Header).keydown(function(a){return b.headerKeyHandler(a)})};
a.prototype.windowKeyHandler=function(b){!this.isDialogOpen||b.keyCode!==CCL.CommonConstants.keyCodes.f5||b.ctrlKey||b.metaKey||b.altKey||b.shiftKey||(b.preventDefault(),this.dataLoader.canRefresh&&this.refreshGrader())};a.prototype.headerKeyHandler=function(b){b.keyCode===CCL.CommonConstants.keyCodes.arrowRight?this.isDialogOpen&&this.navigateTo(e.Next):b.keyCode===CCL.CommonConstants.keyCodes.arrowLeft&&this.isDialogOpen&&this.navigateTo(e.Previous)};a.prototype.refreshGrader=function(){var b=this;
this.currentAssessment&&this.currentAssessment.isFeedbackAreaInFocus&&this.currentAssessment.updateInlineEditorText();this.dataLoader.canRefresh&&this.forgotToSaveHandler().done(function(){b.refreshGraderWithoutConfirm()})};a.prototype.refreshGraderWithoutConfirm=function(){var b=this;if(this.dataLoader.canRefresh){var a=this.loadingStarted(),c=this.dataLoader.refreshCurrent(a);c&&c.done(function(f){b.cancelableInit(f,a)}).fail(function(a){b.loadingFail(a)})}};a.prototype.navigateTo=function(b){var a=
this;if(b===e.Next){if(!this.dataLoader.canNextNavigate)return}else if(!this.dataLoader.canPreviousNavigate)return;this.forgotToSaveHandler().done(function(){var c=a.loadingStarted(),f;(f=b===e.Next?a.dataLoader.goToNext(c):a.dataLoader.goToPrevious(c))&&f.done(function(b){a.cancelableInit(b,c)}).fail(function(b){a.loadingFail(b)})})};a.prototype.loadingStarted=function(){this.cancellationTokenSource.cancel();this.isLoading=!0;this.clear();this.$loadingIndicator||(this.$loadingIndicator=a.createLoadingIndicator(c.Constants.ClientIds.GraderLoadingIndicator));
this.dialog.updateContentWithHtmlString(this.$loadingIndicator.get(0).outerHTML);return this.cancellationTokenSource.createToken()};a.prototype.loadingComplete=function(){this.$dialogContent.find("#"+c.Constants.ClientIds.GraderLoadingIndicator).remove();this.isLoading=!1};a.prototype.loadingFail=function(b){switch(b){case Tools.RequestCancelReasons.AjaxPostError:console.error("Error loading data"),this.$dialogContent.find("#"+c.Constants.ClientIds.GraderLoadingIndicator).remove()}};a.createLoadingIndicator=
function(b){return $("<div>").attr("id",b).addClass(c.CssClasses.Grader.LoadingIndicator)};a.prototype.forgotToSaveHandler=function(){var b=this,a=$.Deferred();if(this.isLoading)return a.resolve(),a.promise();this.forgotToSave.checkCanILeave().done(function(f){switch(f){case c.LeaveAction.Cancel:a.reject();break;case c.LeaveAction.SaveAndContinue:b.currentAssessment.save().done(function(){a.resolve()}).fail(function(b){$(document).trigger(c.Constants.Events.AssessmentSaveFailed,[b]);a.reject()});
break;default:a.resolve()}});return a.promise()};return a}();c.AllInOneGrader=d})(Assignment||(Assignment={}));
(function(c){var e=CCL.CommonFunctions,d=CCL.CommonWindowMessages,a=function(){function b(a,d){var f=this;this.onPdfViewerInitialized=function(){var a=b.pdfViewerInstance;f.settings.IsOpenInCssModal&&(a.disablePreviousStateCaching=!0,a.pdfViewer.removePageBorders=!0);a.pdfViewer.imageResourcesPath=f.settings.ImageResourcesPath;a.setTitle(f.settings.FileName);if(f.fileUrl){a.eventBus.on("textlayerrendered",function(a){f.manager.renderLayer(a,b.scale)});var c=function(){f.manager.scaleChanged(b.scale)};
a.eventBus.on("scalechanged",c);a.eventBus.on("zoomin",c);a.eventBus.on("zoomout",c);[].forEach.call(document.querySelectorAll("#outerContainer button"),function(b){b.setAttribute("type","button")})}else f.settings.ErrorMessage?a.error(f.settings.ErrorMessage):a.error(f.settings.Terms.ErrorOccured)};this.onPdfViewerPreferencesInitialized=function(){b.pdfViewerInstance.preferences.set("enablePermissions",!f.settings.IsAssignmentAnswerFile);b.pdfViewerInstance.preferences.set("renderInteractiveForms",
f.settings.IsFillableFormsEnabled)};this.clearPdfViewerInstance=function(){var a=b.pdfViewerInstance;if(a)try{a.close(),document.removeEventListener(b.PdfViewerInitializedEventType,f.onPdfViewerInitialized),document.removeEventListener(Assignment.Constants.Events.AnswerViewingFinished,f.clearPdfViewerInstance)}catch(l){}};this.settings=a;this.isModernPdfViewerSupported=d;this.pdfjs=window.PDFJS;this.manager=new c.Manager(a);a.IsFillableFormsEnabled&&(this.fillableFormsManager=new c.FillableFormsManager(a));
window.opener&&$("."+this.settings.CssClasses.CloseButton).hide()}b.prototype.init=function(){var b=this;(function(a){$.get(a).done(function(a){b.fileUrl=a.directUrl?a.directUrl:null;b.loadAnnotationApp(b.fileUrl)}).fail(function(){b.loadAnnotationApp(null)})})(this.settings.Urls.FileInfoUrl)};b.prototype.loadAnnotationApp=function(a){var f=this;if(!this.settings.IsOpenInCssModal){e.makePostMessageCall(window.parent,new d.GenericMessageWithData(d.MessageNames.extensionContentOpened,{iframeWidth:-1,
iframeHeight:-1}));e.makePostMessageCall(window.parent,new d.GenericMessageWithData(d.MessageNames.iframeAutoHeight,{enabled:!0}));if(this.settings.Onboarding){var k=this.settings.Onboarding.AddNoteDialogClientId;(new c.OnboardingTour).init(k,this.settings.OnboardingCssClasses)}$("."+this.settings.CssClasses.CloseButton).on("click",function(){e.makePostMessageCall(window.parent,new d.GenericMessageWithData(d.MessageNames.iframeAutoHeight,{enabled:!1}));history.go(-1)})}$(function(){document.addEventListener(b.PdfViewerInitializedEventType,
f.onPdfViewerInitialized);document.addEventListener(b.PdfViewerPreferencesInitializedEventType,f.onPdfViewerPreferencesInitialized);document.addEventListener(Assignment.Constants.Events.AnswerViewingFinished,f.clearPdfViewerInstance);f.pdfjs.webViewerLoad({fileUrl:a,fileName:f.settings.FileName,workerSrc:f.isModernPdfViewerSupported?f.settings.PdfJsWorker:f.settings.PdfJsES5Worker,cmapsSrc:f.settings.PdfJsCmapsFolder,locale:c.LocaleProvider.Get(f.settings.Language)})})};Object.defineProperty(b,"pdfViewerInstance",
{get:function(){return window[b.pdfViewerInstanceName]},enumerable:!0,configurable:!0});Object.defineProperty(b,"pagesCount",{get:function(){return this.pdfViewerInstance.pdfViewer.pagesCount},enumerable:!0,configurable:!0});Object.defineProperty(b,"scale",{get:function(){return this.pdfViewerInstance.pdfViewer.currentScale},enumerable:!0,configurable:!0});b.isModernPdfViewerSupported=function(){return Tools.ScriptLoader.supportsES6Modules()&&!("undefined"===typeof ReadableStream||"undefined"===typeof Promise.allSettled)&&
Tools.ScriptLoader.supportsNullishCoalescing()};b.pdfViewerInstanceName="PDFViewerApplication";b.PdfViewerInitializedEventType="PdfViewerInitialized";b.PdfViewerPreferencesInitializedEventType="PdfViewerPreferencesInitialized";return b}();c.AnnotationApp=a})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.prototype.init=function(a,b){(new Assignment.Onboarding.Step(b,a,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAddNote)).start()};return c}();c.OnboardingTour=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.AnnotationAttributesModel=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(a){var b=this;this.setArrow=function(a){b.clearArrowCss();switch(a){case c.sides.top:b.$boxElement.addClass(b.arrowCssClasses.top);break;case c.sides.bottom:b.$boxElement.addClass(b.arrowCssClasses.bottom)}};this.clearArrowCss=function(){b.$boxElement.removeClass(b.arrowCssClasses.top+" "+b.arrowCssClasses.right+" "+b.arrowCssClasses.bottom+" "+b.arrowCssClasses.left)};this.$boxElement=a.$boxElement;this.$within=a.$within;this.arrowCssClasses=a.arrowCssClasses}
c.prototype.showBox=function(a,b){a=this.createTargetElement(a,b);this.position(a)};c.prototype.hideBox=function(){this.$boxElement.hide()};c.prototype.createTargetElement=function(a,b){var c=$("<div></div>");b.append(c);c.css({left:a.left-b.offset().left,top:a.top-b.offset().top,width:a.width,height:a.height,position:"absolute",visibility:"hidden"});return c};c.prototype.position=function(a){var b=this;this.$boxElement.show().position({my:"center bottom-10",at:"center top",of:a,collision:"flipfit flipfit",
within:this.$within,using:function(c,d){b.$boxElement.css(c);b.side=b.getSide(d);b.setArrow(b.side);a.remove()}})};c.prototype.getSide=function(a){return this.isBoxCentered(a)?a.vertical:c.sides.inside};c.prototype.isBoxCentered=function(a){return a.target.width/4<Math.abs(a.target.left+a.target.width/2-(a.element.left+a.element.width/2))?!1:!0};c.sides={top:"top",bottom:"bottom",inside:"inside"};return c}();c.Box=e})(Annotations||(Annotations={}));
(function(c){var e=function(){return function(){}}();c.ArrowCssClassesModel=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.BoxSettingsModel=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){this.cache={}}c.prototype.addPageItem=function(a,b){a=this.pageKey(a);this.cache.hasOwnProperty(a)||(this.cache[a]=[]);this.cache[a].push(b)};c.prototype.getByPage=function(a){a=this.pageKey(a);if(this.cache.hasOwnProperty(a)){a=this.cache[a];var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}return null};c.prototype.delete=function(a,b){this.cache[this.pageKey(a)].splice(b,1)};c.prototype.update=function(a,b,c){this.cache[this.pageKey(a)][b]=
c};c.prototype.pageKey=function(a){return"page_"+a};return c}();c.MemoryDataStorage=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.Annotation=e})(Annotations||(Annotations={}));(function(c){var e=function(d){function a(){d.apply(this,arguments);this.LastPromise=null;this.Id=new c.AnnotationCacheId}__extends(a,d);return a}(c.Annotation);c.AnnotationCache=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(a){this.value=a}c.prototype.valueOf=function(){return this.value};return c}();c.LocalAnnotationIdType=e;e=function(){function c(a){this.value=a}c.prototype.valueOf=function(){return this.value};return c}();c.RemoteAnnotationIdType=e;e=function(){return function(){}}();c.AnnotationCacheId=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.adjustRectangles=function(a){return $.map(a,function(b){return{x:b.left?b.left:b.x,y:b.top?b.top:b.y,width:b.width,height:b.height}})};c.adjustToViewport=function(a,b){return $.map(a,function(a){return{x:(a.x-b.offsetX)*b.scale,y:(a.y-b.offsetY)*b.scale,width:a.width*b.scale,height:a.height*b.scale}})};c.adjustToDefaultScale=function(a,b){return $.map(a,function(a){return{x:(a.x-b.offsetX)/b.scale,y:(a.y-b.offsetY)/b.scale,width:a.width/b.scale,height:a.height/
b.scale}})};c.adjustPointToViewport=function(a,b){b={x:a.x*b,y:a.y*b,strokeColor:a.strokeColor};a.lineWidth&&(b.lineWidth=a.lineWidth);return b};c.adjustPointToDefaultScale=function(a,b){b={x:this.roundTo1DP(a.x/b),y:this.roundTo1DP(a.y/b),strokeColor:a.strokeColor};a.lineWidth&&(b.lineWidth=this.roundTo1DP(a.lineWidth));return b};c.roundTo1DP=function(a){return 1*Number(a.toFixed(1))};c.getRectanglesBounds=function(a){for(var b={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity,width:0,
height:0},c=0;c<a.length;c++){var d=a[c];b.top>d.top&&(b.top=d.top);b.right<d.right&&(b.right=d.right);b.bottom<d.bottom&&(b.bottom=d.bottom);b.left>d.left&&(b.left=d.left)}b.width=b.right-b.left;b.height=b.bottom-b.top;return b};return c}();c.RectanglesTransformation=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.searchById=function(b,a,d){if(!b)return[new c.AnnotationCache,-1];for(var f=0;f<b.length;f++)if(d(b[f],a))return[b[f],f];return[new c.AnnotationCache,-1]};this.searchByType=function(a,d){if(!a)return[new c.AnnotationCache,-1];for(var f=0;f<a.length;f++)if(b.filterByType(a[f],d))return[a[f],f];return[new c.AnnotationCache,-1]};this.filterByLocalId=function(b,a){return b.Id.LocalId&&b.Id.LocalId.valueOf()===a.valueOf()};this.filterByRemoteId=
function(b,a){return b.Id.RemoteId&&b.Id.RemoteId.valueOf()===a.valueOf()};this.filterByType=function(b,a){return b.Type&&b.Type===a};this.cache=a}d.prototype.add=function(a,b,f){var d=b instanceof c.LocalAnnotationIdType,e=new c.AnnotationCache;$.extend(e,f);d?e.Id.LocalId=b:e.Id.RemoteId=b;this.cache.addPageItem(a,e)};d.prototype.get=function(a,b){var f=b instanceof c.LocalAnnotationIdType;a=this.cache.getByPage(a);return this.searchById(a,b,f?this.filterByLocalId:this.filterByRemoteId)[0]};d.prototype.getIndex=
function(a,b){var f=b instanceof c.LocalAnnotationIdType;a=this.cache.getByPage(a);return this.searchById(a,b,f?this.filterByLocalId:this.filterByRemoteId)[1]};d.prototype.getByPage=function(a){return this.cache.getByPage(a)};d.prototype.getByPageAndType=function(a,b){a=this.cache.getByPage(a);return this.searchByType(a,b)[0]};d.prototype.delete=function(a,b){b=this.getIndex(a,b);this.cache.delete(a,b)};d.prototype.updateAnnotation=function(a,b,f,d,e){void 0===d&&(d=!0);void 0===e&&(e=!1);var g=this.getIndex(a,
b);b=this.get(a,b);d&&(f.Text=b.Text);e&&(f.Structure=b.Structure);f.LastPromise=b.LastPromise;f.Id=b.Id;f.Id.RemoteId=new c.RemoteAnnotationIdType(parseInt(f.AnnotationId));this.cache.update(a,g,f)};return d}();c.MemoryDataStorageProvider=e})(Annotations||(Annotations={}));
(function(c){var e=function(d){function a(b){var a=this;d.call(this,b.boxSettings);this.isEditMode=!1;this.disableSaveButtonIfTextEmpty=function(){a.getTextAreaVal().trim()?a.saveButton.toggleHyperlink(!0):a.saveButton.toggleHyperlink(!1)};this.boxReposition=function(){var b=a.$boxElement.height();if(b!==a.boxHeight){var f=parseFloat(a.$boxElement.css("top"));switch(a.side){case c.Box.sides.bottom:var d=b-a.boxHeight;break;default:d=0}a.$boxElement.css("top",f-d);a.boxHeight=b}};this.onDelete=function(){a.$boxElement.find("."+
a.cssClasses.AnnotationTooltipDeleteButton).getIfHyperLinkEnabled()&&(a.isEditMode=!1,a.deleteHandler(),a.hide(0))};this.onUpdate=function(){a.saveButton.getIfHyperLinkEnabled()&&(a.isEditMode=!1,a.updateHandler(a.getTextAreaVal()),a.setText(a.getTextAreaVal()),a.toggleForEditing(),a.boxReposition())};this.show=function(b,f,d){a.isEditMode||(a.boxHeight=a.$boxElement.height(),b=a.addOffset(c.RectanglesTransformation.getRectanglesBounds(a.transformRectangles(b)),f),a.showBox(b,d),a.saveButton.is(":visible")&&
a.toggleForEditing())};this.hide=function(b){void 0===b&&(b=0);a.isEditMode||(0===b?a.hideBox():a.$boxElement.delay(b).hide(0))};this.forceHide=function(){a.isEditMode=!1;a.hideBox()};this.toggleForEditing=function(){a.$boxElement.find("."+a.cssClasses.AnnotationTooltipSaveButton+", ."+a.cssClasses.AnnotationTooltipEditButton).toggle();a.$boxElement.find("."+a.cssClasses.AnnotationTooltipDeleteButton+", ."+a.cssClasses.AnnotationTooltipCancelButton).toggle();a.$boxElement.find("."+a.cssClasses.AnnotationTooltipText+
", ."+a.cssClasses.AnnotationTooltipTextareaContainer).toggle()};this.hideForReadOnly=function(){a.$boxElement.find("."+a.cssClasses.AnnotationTooltipSaveButton+", ."+a.cssClasses.AnnotationTooltipEditButton+", "+("."+a.cssClasses.AnnotationTooltipDeleteButton+", ."+a.cssClasses.AnnotationTooltipCancelButton)).hide()};this.cssClasses=b.cssClasses;this.genericUserIcon=b.genericUserIcon;this.deleteHandler=b.onDelete;this.updateHandler=b.onUpdate;this.readOnlyMode=b.readOnlyMode;this.pageBorderSize=
b.pageBorderSize;this.saveButton=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipSaveButton);this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);this.readOnlyMode&&this.hideForReadOnly();this.initEvents()}__extends(a,d);a.prototype.initEvents=function(){var b=this;this.readOnlyMode||(this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipDeleteButton,this.onDelete),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){b.isEditMode=
!1;b.toggleForEditing();b.boxReposition()}),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipEditButton,function(){b.$boxElement.find("."+b.cssClasses.AnnotationTooltipEditButton).getIfHyperLinkEnabled()&&(b.isEditMode=!0,b.textAreaHeight=parseFloat(b.$boxElement.find("."+b.cssClasses.AnnotationTooltipText).css("height")),b.textArea.css("height",b.textAreaHeight),b.toggleForEditing(),b.textArea.focus(),b.setTextAreaVal(b.getText()),b.disableSaveButtonIfTextEmpty(),b.boxReposition())}),
this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipSaveButton,this.onUpdate),this.$boxElement.on("input","."+this.cssClasses.AnnotationTooltipTextarea,this.disableSaveButtonIfTextEmpty))};a.prototype.getText=function(){return this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text()};a.prototype.setText=function(b){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text(b)};a.prototype.getTextAreaVal=function(){return this.textArea.val()};a.prototype.setTextAreaVal=
function(b){this.textArea.val("");this.textArea.val(b)};a.prototype.setIcon=function(b){b?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",b):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon)};a.prototype.setTitle=function(b){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonName).text(b)};a.prototype.disableEditButton=function(b){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipEditButton).toggleHyperlink(b)};
a.prototype.disableDeleteButton=function(b){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipDeleteButton).toggleHyperlink(b)};a.prototype.addOffset=function(b,a){return{left:b.left+a.offset().left+this.pageBorderSize,top:b.top+a.offset().top+this.pageBorderSize,right:b.right+a.offset().left+this.pageBorderSize,bottom:b.bottom+a.offset().top+this.pageBorderSize,width:b.width,height:b.height}};a.prototype.transformRectangles=function(b){return $.map(b,function(b){return{left:b.x,top:b.y,
right:b.x+b.width,bottom:b.y+b.height}})};return a}(c.Box);c.TooltipBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(c){function a(b){var a=this;c.call(this,b.boxSettings);this.disablePostButtonIfTextEmpty=function(){a.textArea.val().trim()?a.postButton.toggleHyperlink(!0):a.postButton.toggleHyperlink(!1)};this.onPost=function(b){if(a.postButton.getIfHyperLinkEnabled()){var c=a.textArea.val();a.postHandler({text:c},b);a.textArea.val("")}};this.show=function(b,c){a.showBox(b,c);a.textArea.val("");a.textArea.focus();a.postButton.toggleHyperlink(!1)};this.cssClasses=b.cssClasses;this.genericUserIcon=
b.genericUserIcon;this.postHandler=b.onPost;this.cancelHandler=b.onCancel;this.postButton=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPostButton);this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);b.iconUrl?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",b.iconUrl):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon);this.initEvents()}__extends(a,c);
a.prototype.initEvents=function(){var b=this;this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipPostButton,this.onPost);this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){b.cancelHandler();b.hideBox()});this.$boxElement.on("input","."+this.cssClasses.AnnotationTooltipTextarea,this.disablePostButtonIfTextEmpty)};return a}(c.Box);c.AddAnnotationBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(c){function a(b){var a=this;c.call(this,b.boxSettings);this.show=function(b,c){a.showBox(b,c)};this.$boxElement.click(b.click)}__extends(a,c);return a}(c.Box);c.BubbleBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a,b,c){this.$pageDiv=$(a);this.attributes=b;this.cssClasses=c;this.$textLayerDiv=$(this.$pageDiv.find(".textLayer"));this.annotationLayerDiv=$(this.$pageDiv)[0].getElementsByClassName("annotationLayer")[0];this.number=parseInt(this.$pageDiv.attr("data-page-number"))}d.prototype.getPageDiv=function(){return this.$pageDiv};Object.defineProperty(d.prototype,"getAnnotationLayerDiv",{get:function(){return this.annotationLayerDiv},enumerable:!0,configurable:!0});
d.prototype.getTextLayerTransformScale=function(){return this.$textLayerDiv.height()/this.$pageDiv.height()};d.prototype.getDefaultScaleRectangles=function(a,b){b={scale:b,offsetX:this.$textLayerDiv.offset().left,offsetY:this.$textLayerDiv.offset().top};a=c.RectanglesTransformation.adjustRectangles(a);return c.RectanglesTransformation.adjustToDefaultScale(a,b)};d.prototype.getActualScaleRectangles=function(a,b){b={scale:b,offsetX:0,offsetY:0};a=c.RectanglesTransformation.adjustRectangles(a);return c.RectanglesTransformation.adjustToViewport(a,
b)};d.prototype.renderAnnotation=function(a,b,f,d){void 0===d&&(d=!1);f={scale:f*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};b=c.RectanglesTransformation.adjustRectangles(b);b=c.RectanglesTransformation.adjustToViewport(b,f);a=c.ShapeBuilder.createHighlight(b,this.cssClasses.AnnotationHighlight).attr(this.attributes.AnnotationId,a.AnnotationId).attr(this.attributes.AnnotationType,a.Type).attr(this.attributes.AnnotationComment,a.Text).addClass(this.cssClasses.AnnotationContainer+" "+this.cssClasses.TooltipAble);
d&&a.attr(this.attributes.AnnotationIsLocal,"true");this.$textLayerDiv.append(a)};d.prototype.renderSelection=function(a,b){b={scale:b*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};a=c.RectanglesTransformation.adjustRectangles(a);a=c.RectanglesTransformation.adjustToViewport(a,b);a=c.ShapeBuilder.createHighlight(a,this.cssClasses.Selection).addClass(this.cssClasses.SelectionContainer);this.$textLayerDiv.prepend(a)};d.prototype.removeAnnotation=function(a){this.$textLayerDiv.find("."+this.cssClasses.AnnotationContainer+
"["+this.attributes.AnnotationId+"="+a+"]").remove()};d.prototype.removeSelection=function(){this.getPageDiv().find("."+this.cssClasses.SelectionContainer).remove()};d.prototype.updateAnnotationId=function(a,b){this.getPageDiv().find("["+this.attributes.AnnotationId+"="+a+"]").attr(this.attributes.AnnotationId,b).removeAttr(this.attributes.AnnotationIsLocal)};return d}();c.Page=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.hasFillableForms=null;this.attributes={AnnotationId:"data-pdf-annotate-id",AnnotationIsLocal:"data-pdf-annotate-local",AnnotationComment:"data-pdf-annotate-comment",AnnotationType:"data-pdf-annotate-type"};this.scrollChanged=function(){b.selection&&b.tooltip.hide()};this.scaleChanged=function(a){b.scale=a;b.closeAnnotationTooltip()};this.closeAnnotationTooltip=function(){b.bubble&&b.bubble.hideBox();b.addAnnotation&&b.addAnnotation.hideBox();
b.tooltip&&b.tooltip.hideBox()};this.attachTextLayerEvents=function(a,c){if(b.settings.IsReadOnly||b.hasFillableForms)if(Tools.Misc.isTouchDevice())$(a).on("touchstart",b.tooltip.forceHide);else $(a).mouseup(b.tooltip.forceHide);else if(Tools.Misc.isTouchDevice())$(a).on("touchstart",b.triggerBubble);else $(a).mouseup(b.triggerBubble),$(a).mousedown(function(){b.selection&&b.selection.eraseNative()});$(a).on("click touchstart",function(a){$(a.target).parent().hasClass(b.settings.CssClasses.TooltipAble)||
b.tooltip.forceHide()});$(a).on("click touchstart","."+b.settings.CssClasses.TooltipAble,function(a){return b.triggerTooltip(a,c)});a.addEventListener("pointerdown",function(a){b.handleDrawingStart(a,c.number)},!1)};this.handleDrawingStart=function(a,f){b.drawingManager.isDrawingToolsActive()||c.Drawing.DrawingManager.isPen(a)&&b.drawingManager.handlePenDrawing(a,f)};this.showAnnotationBox=function(){b.selection.eraseNative();b.bubble.hideBox();b.addAnnotation.show(b.selection.getBoundary(),b.$viewer)};
this.addAnnotationCancel=function(){b.selection.getPage().removeSelection()};this.createAnnotation=function(a){var f=b.selection.getPage(),d=f.getDefaultScaleRectangles(b.selection.getClientRects(),b.scale),e={FileId:b.settings.FileRepoId,Annotation:{Text:"text",Page:f.number,Type:1},Shape:{Structure:JSON.stringify(d)},Comment:{Text:a.text}},g=b.uuid();a={Type:1,Text:a.text,AnnotationId:g,Page:f.number,Structure:JSON.stringify(d),ProfileImageSmallUrl:b.settings.Urls.UserProfileImage,FullName:b.settings.UserFullName,
HasEditPermission:!0};b.storage.add(f.number,new c.LocalAnnotationIdType(g),e,a).done(function(a){f.updateAnnotationId(g,a.AnnotationId);b.tooltip.annotation&&b.tooltip.annotation.AnnotationId===g&&(b.tooltip.annotation.AnnotationId=a.AnnotationId,b.tooltip.setText(a.Text),b.tooltip.isLocal=!1)}).fail(function(a){a.status===CCL.CommonConstants.httpStatusCodes.badRequest&&f.removeAnnotation(g)});f.renderAnnotation(a,d,b.scale,!0);f.removeSelection();b.addAnnotation.hideBox()};this.removeAnnotation=
function(){var a=b.tooltip.isLocal?new c.LocalAnnotationIdType(b.tooltip.annotation.AnnotationId):new c.RemoteAnnotationIdType(b.tooltip.annotation.AnnotationId);b.storage.delete(b.tooltip.annotation.Page,a);b.tooltip.page.removeAnnotation(b.tooltip.annotation.AnnotationId)};this.updateAnnotation=function(a){var f=b.tooltip.isLocal?new c.LocalAnnotationIdType(b.tooltip.annotation.AnnotationId):new c.RemoteAnnotationIdType(b.tooltip.annotation.AnnotationId);b.storage.update(b.tooltip.annotation.Page,
f,a).done(function(a){b.tooltip.annotation&&b.tooltip.annotation.AnnotationId===a.AnnotationId&&b.tooltip.setText(a.Text)})};this.triggerBubble=function(a){b.selection&&b.selection.getPage().removeSelection();b.selection=new c.TextSelection({pageDiv:$(a.target).closest(".page"),attributes:b.attributes,cssClasses:b.settings.CssClasses});if(b.selection.isEmpty())b.bubble.hideBox();else{a=b.selection.getPage();var f=b.selection.getClientRects();f=a.getDefaultScaleRectangles(f,b.scale);a.renderSelection(f,
b.scale);b.selection.saveDefaultScaleSelection(f);b.bubble.show(b.selection.getBoundary(),b.$viewer)}b.addAnnotation.hideBox();Tools.Misc.isTouchDevice()||b.tooltip.forceHide()};this.triggerTooltip=function(a,f){if(!b.tooltip.isEditMode){var d=$(a.currentTarget).attr(b.attributes.AnnotationId),e=$(a.currentTarget).attr(b.attributes.AnnotationIsLocal)?!0:!1;a=e?new c.LocalAnnotationIdType(d):new c.RemoteAnnotationIdType(parseInt(d));b.storage.getAnnotationByPage(f.number,a).then(function(a){b.tooltip.annotation=
a;b.tooltip.isLocal=e;b.tooltip.page=f;b.tooltip.setText(a.Text);b.tooltip.setTitle(a.FullName);b.tooltip.setIcon(a.ProfileImageSmallUrl);b.tooltip.disableEditButton(a.HasEditPermission);b.tooltip.disableDeleteButton(a.HasEditPermission||!b.settings.IsFillableFormsEnabled);b.tooltip.show(f.getActualScaleRectangles(JSON.parse(a.Structure),b.scale),f.getPageDiv(),b.$viewer)})}};this.settings=a;var f=$("#viewerContainer"),d={top:a.CssClasses.BubbleArrowTop,bottom:a.CssClasses.BubbleArrowBottom},e={top:a.CssClasses.TooltipArrowTop,
bottom:a.CssClasses.TooltipArrowBottom};a.IsReadOnly||(this.bubble=new c.BubbleBox({boxSettings:{$boxElement:$("#bubbleBox"),$within:f,arrowCssClasses:d},click:this.showAnnotationBox}),this.addAnnotation=new c.AddAnnotationBox({boxSettings:{$boxElement:$("#addAnnotationBox"),$within:f,arrowCssClasses:e},onPost:this.createAnnotation,onCancel:this.addAnnotationCancel,iconUrl:a.Urls.UserProfileImage,cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar}));this.tooltip=new c.TooltipBox({boxSettings:{$boxElement:$("#tooltipBox"),
$within:f,arrowCssClasses:e},onDelete:this.removeAnnotation,onUpdate:this.updateAnnotation,readOnlyMode:a.IsReadOnly,cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar,pageBorderSize:a.IsOpenInCssModal?0:9});f.on("scroll",this.scrollChanged);document.addEventListener(Assignment.Constants.Events.AnnotationDrawingActive,this.closeAnnotationTooltip);this.storage=new c.ServerStorage(a);this.drawingManager=new c.Drawing.DrawingManager(a,this.storage);new c.PrintManager(this.storage,this.drawingManager)}
d.prototype.renderLayer=function(a,b){var f=this;this.$viewer=$("#viewer");this.scale=b;if(a.source.textLayerDiv.parentElement){var d=new c.Page(a.source.textLayerDiv.parentElement,this.attributes,this.settings.CssClasses);this.drawingManager.renderLayer(d.number,b);this.storage.getByPage(d.number).then(function(a){for(var c=[],e=0;e<a.length;e++){var g=a[e];1===g.Type?d.renderAnnotation(g,JSON.parse(g.Structure),b):2===g.Type&&c.push.apply(c,JSON.parse(g.Structure))}0<c.length&&f.drawingManager.renderDrawing(c,
d.number)});setTimeout(function(){f.drawingManager.ensureDrawing()},100);this.detectFillableForm().then(function(){f.attachTextLayerEvents(a.source.textLayerDiv,d)})}};d.prototype.detectFillableForm=function(){var a=this;return new Promise(function(b){a.settings.IsFillableFormsEnabled&&null===a.hasFillableForms||b();a.checkAnnotationsStartingFromPage(1).then(function(){b()})})};d.prototype.checkAnnotationsStartingFromPage=function(a){var b=this;return new Promise(function(f){c.AnnotationApp.pdfViewerInstance.pdfDocument.getPage(a).then(function(d){d.getAnnotations().then(function(d){if(0<
d.length&&b.hasFillableAnnotations(d))b.hasFillableForms=!0,f();else if(a<c.AnnotationApp.pdfViewerInstance.pdfDocument.numPages)b.checkAnnotationsStartingFromPage(a+1).then(function(){f()});else{b.hasFillableForms=!1;d=0;for(var e=document.getElementsByClassName(b.settings.CssClasses.AnnotationButton);d<e.length;d++)e[d].style.display="block";f()}})})})};d.prototype.hasFillableAnnotations=function(a){for(var b=0;b<a.length;b++)if("Widget"===a[b].subtype)return!0;return!1};d.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
this.replacement)};d.prototype.replacement=function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)};return d}();c.Manager=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.defaultContentType="application/json;charset=utf-8";this.drawingTimeoutByPage={};this.drawingAnnotationByPage={};this.delay=2E3;this.failResponseHandler=function(a){a.status===CCL.CommonConstants.httpStatusCodes.internalServerError&&CCL.CommonFunctions.jAjaxAlert(b.settings.Terms.ErrorOccured,"",b.settings.Terms.Ok);a.status===CCL.CommonConstants.httpStatusCodes.badRequest&&(a=jQuery.parseJSON(a.responseText),CCL.CommonFunctions.jAjaxAlert(a?
a.Message:b.settings.Terms.ErrorOccured,"",b.settings.Terms.Ok))};this.settings=a;this.endpoint=a.Urls.Endpoint;a=new c.MemoryDataStorage;this.cacheProvider=new c.MemoryDataStorageProvider(a);window.addEventListener("beforeunload",function(){Object.keys(b.drawingAnnotationByPage).forEach(function(a){b.drawingTimeoutByPage[a]&&b.addUpdateDrawingSync(a,b.drawingAnnotationByPage[a])})})}d.prototype.update=function(a,b,c){var f=this,d=this.cacheProvider.get(a,b).Text;this.cacheProvider.get(a,b).Text=
c;var e=function(){var d=f.cacheProvider.get(a,b);return $.ajax({type:"PUT",url:f.endpoint,data:JSON.stringify({AnnotationId:d.AnnotationId,AnnotationCommentId:d.AnnotationCommentId,Text:c}),contentType:f.defaultContentType})},l=this.cacheProvider.get(a,b).LastPromise;if(l){var m=l.pipe(e);this.cacheProvider.get(a,b).LastPromise=m}else m=$.when(e());m.done(function(d){if(c!==d.Text){var e=f.cacheProvider.get(a,b).LastPromise;if(null===e||e===m)f.cacheProvider.get(a,b).Text=d.Text}}).fail(function(c){c.status===
CCL.CommonConstants.httpStatusCodes.badRequest&&(f.cacheProvider.get(a,b).Text=d);f.failResponseHandler(c)});return m};d.prototype.delete=function(a,b){var c=this,d=function(){var f=c.cacheProvider.get(a,b);return $.ajax({type:"DELETE",url:c.endpoint+"&annotationId="+f.AnnotationId,contentType:c.defaultContentType}).done(function(){c.cacheProvider.delete(a,b)}).fail(c.failResponseHandler)},e=this.cacheProvider.get(a,b).LastPromise;e?e.pipe(d):d()};d.prototype.add=function(a,b,c,d){var f=this,e=$.ajax({type:"POST",
url:this.endpoint,data:JSON.stringify(c),contentType:this.defaultContentType});d.LastPromise=e;this.cacheProvider.add(a,b,d);e.done(function(c){var d=f.cacheProvider.get(a,b).LastPromise!==e;f.cacheProvider.updateAnnotation(a,b,c,d)}).fail(function(c){c.status===CCL.CommonConstants.httpStatusCodes.badRequest&&f.cacheProvider.delete(a,b);f.failResponseHandler(c)});return e};d.prototype.addUpdateDrawing=function(a,b){var c=this;this.drawingTimeoutByPage[a]&&clearTimeout(this.drawingTimeoutByPage[a]);
this.drawingAnnotationByPage[a]=b;this.drawingTimeoutByPage[a]=setTimeout(function(){c.addUpdateDrawingDebounce(a,c.drawingAnnotationByPage[a]);c.drawingTimeoutByPage[a]=void 0},this.delay)};d.prototype.addUpdateDrawingDebounce=function(a,b){var f=this,d=this.cacheProvider.getByPageAndType(a,2);d&&d.AnnotationId&&(b.Annotation.AnnotationId=d.AnnotationId);b=$.ajax({type:"POST",url:this.endpoint,data:JSON.stringify(b),contentType:this.defaultContentType});b.done(function(b){f.cacheProvider.add(a,new c.LocalAnnotationIdType(a.toString()),
b)}).fail(function(a){f.failResponseHandler(a)});return b};d.prototype.addUpdateDrawingSync=function(a,b){(a=this.cacheProvider.getByPageAndType(a,2))&&a.AnnotationId&&(b.Annotation.AnnotationId=a.AnnotationId);"function"!==typeof navigator.sendBeacon?(a=new XMLHttpRequest,a.open("POST",this.endpoint,!1),a.setRequestHeader("Content-Type",this.defaultContentType),a.send(JSON.stringify(b))):(a={type:this.defaultContentType},b=new Blob([JSON.stringify(b)],a),navigator.sendBeacon(this.endpoint,b))};d.prototype.getByPage=
function(a){var b=this.cacheProvider.getByPage(a);return null===b?this.load([a]):$.Deferred().resolve(b)};d.prototype.getAnnotationByPage=function(a,b){b=this.cacheProvider.get(a,b);return null===b?this.load([a]):$.Deferred().resolve(b)};d.prototype.getByPageFromCache=function(a){return this.cacheProvider.getByPage(a)};d.prototype.load=function(a,b,f){var d=this;void 0===b&&(b=!1);void 0===f&&(f=null);var e="",h="";if(a)a=a.map(function(a,b){return"pages="+a}).reduce(function(a,b,c){return a+"&"+
b},"");else throw Error("pages or page should be specified");0!==this.settings.AnnotationOfUserId&&(e="&userId="+this.settings.AnnotationOfUserId);b&&(h="&loadAllPages=true");return $.get(this.endpoint+a+e+h).done(function(a,b,e){for(b=0;b<a.length;b++)d.cacheProvider.add(a[b].Page,new c.RemoteAnnotationIdType(a[b].AnnotationId),a[b]);f&&f()}).fail(function(a){d.failResponseHandler(a);f&&f()})};return d}();c.ServerStorage=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.createHighlight=function(a,b){var c=this,d=$("<div>");$.each(a,function(a,f){a=c.rectangleToDiv(f).addClass(b);d.append(a)});return d};c.rectangleToDiv=function(a){return $("<div>").css({left:a.x,top:a.y,width:a.width,height:a.height})};return c}();c.ShapeBuilder=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){this.selection=window.getSelection();this.$pageDiv=$(a.pageDiv);this.attributes=a.attributes;this.cssClasses=a.cssClasses;this.offsetTop=this.$pageDiv.offset().top;this.offsetLeft=this.$pageDiv.offset().left;this.freeze()}d.prototype.getPage=function(){return new c.Page(this.$pageDiv,this.attributes,this.cssClasses)};d.prototype.getRectangles=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?this.clientRectsIEHack(a):a.getClientRects()};
d.prototype.getBoundingRect=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?(a=this.getRectangles(),c.RectanglesTransformation.getRectanglesBounds(a)):a.getBoundingClientRect()};d.prototype.getRange=function(){return this.selection.getRangeAt(0)};d.prototype.eraseNative=function(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())};d.prototype.isEmpty=function(){return this.isBrowserIE()&&
0===this.selection.rangeCount?!0:0>=this.getRange().toString().length};d.prototype.freeze=function(){this.isBrowserIE()&&0===this.selection.rangeCount||(this.clientRects=this.getRectangles(),this.boundary=this.getBoundingRect())};d.prototype.saveDefaultScaleSelection=function(a){this.defaultScaleRectangles=a};d.prototype.getBoundary=function(){return this.recalculateRectPositionAfterScroll(this.boundary)};d.prototype.getClientRects=function(){var a=this;return $.map(this.clientRects,function(b){return a.recalculateRectPositionAfterScroll(b)})};
d.prototype.recalculateRectPositionAfterScroll=function(a){var b=this.$pageDiv.offset().top-this.offsetTop,c=this.$pageDiv.offset().left-this.offsetLeft;return{left:a.left+c,top:a.top+b,right:a.right+c,bottom:a.bottom+b,width:a.width,height:a.height}};d.prototype.isBrowserIE=function(){var a=window.navigator.userAgent;return 0<a.indexOf("Trident/")||0<a.indexOf("Edge/")};d.prototype.clientRectsIEHack=function(a){var b;"canvasWrapper"===a.startContainer.className&&a.setStart(a.startContainer.nextSibling.children[0].childNodes[0],
0);if(a.startContainer===a.commonAncestorContainer)return a.getClientRects();var c=[],d=a.cloneRange();d.setEnd(a.startContainer,a.startContainer.length);Array.prototype.push.apply(c,d.getClientRects());for(b=a.startContainer.parentNode.nextSibling;b!==a.endContainer.parentNode&&b&&!$(b).hasClass("endOfContent");)Array.prototype.push.apply(c,b.getClientRects()),b=b.nextSibling;d.setStart(a.endContainer,0);d.setEnd(a.endContainer,a.endOffset);Array.prototype.push.apply(c,d.getClientRects());return c};
return d}();c.TextSelection=e})(Annotations||(Annotations={}));(function(c){var e=function(){function c(){}c.prototype.init=function(){var a=this;return function(){a._isCanceled=!0}};Object.defineProperty(c.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0});c.prototype.then=function(a){if(this._isCanceled)return this;a();return this};return c}();c.CancellationToken=e})(Tools||(Tools={}));
(function(c){(function(c){var d=function(){function a(a,c){var b=this;this.hoverTargets=a;this.tooltip=c;this.toggleTooltipMobile=function(a){if(b.isTriggeredByHoverTarget(a))return b.tooltip.isVisibleForTarget(a.target)?b.tooltip.hide():(b.tooltip.hide(),b.tooltip.show($(a.target))),!1;b.tooltip.hide();return!0};this.onDeviceOrientationChanged=function(){return b.tooltip.hide()};0!==a.length&&(CCL.CommonFunctions.isMobileDevice()?($(document).on(this.toggleEventName,this.toggleTooltipMobile),$(window).on("orientationchange",
this.onDeviceOrientationChanged)):a.each(function(a,c){var f=$(c);f.on("mouseover",function(){return b.tooltip.show(f)}).on("mouseleave",function(){return b.tooltip.hide()})}))}Object.defineProperty(a.prototype,"toggleEventName",{get:function(){return CCL.CommonFunctions.isIosDevice()?"touchend":"click"},enumerable:!0,configurable:!0});a.prototype.isTriggeredByHoverTarget=function(a){for(var b=0;b<this.hoverTargets.length;b++)if(a.target===this.hoverTargets.get(b))return!0;return!1};return a}();c.TooltipToggler=
d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(b,c){this.tooltip=new CCL.CustomTooltip(b,{contentContainer:c,zIndex:10},a.tooltipCssClasses)}a.prototype.show=function(a){this.currentTarget=a.get(0);this.tooltip.openTooltip(a,{My:"center top",At:"center bottom+10",Arrow:"bottom"})};a.prototype.hide=function(){this.currentTarget=null;this.tooltip.closeTooltip()};a.prototype.isVisibleForTarget=function(a){return this.tooltip.isTooltipOpened()&&a===this.currentTarget};a.tooltipCssClasses={TooltipWrapper:"ccl-custom-tooltip",
TooltipArrow:"ccl-custom-tooltip-arrow",Bottom:"bottom",Left:"left",Top:"top",Right:"right"};return a}();c.Tooltip=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){$(document).on("click","a[data-personid], button[data-personid],",function(a){a=$(a.currentTarget);a=parseInt(a.data("personid"));c.requestOpenProfileCard(a)}).on(CCL.KeepAlive.unauthorisedEventName,function(){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.reloadParentIframe))});this.scrollToTop()}c.prototype.scrollToTop=function(){CCL.CommonFunctions.makePostMessageCall(window.parent,
new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.scrollToTop))};c.requestOpenProfileCard=function(a){void 0===a&&(a=0);0<a&&CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.openPersonProfileCard,a))};c.prototype.postMessageToShowSettings=function(a){void 0===a&&(a=!1);this.postMessage(CCL.CommonWindowMessages.MessageNames.showSettings,{ForceReload:a})};c.prototype.postMessageToHideSettings=
function(){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.hideSettings))};c.prototype.postMessage=function(a,b){void 0===b&&(b=void 0);b?CCL.CommonFunctions.makePostMessageCallWithData(window.parent,new CCL.CommonWindowMessages.GenericMessage(a),b):CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(a))};return c}();c.Base=e})(Assignment||(Assignment={}));
(function(c){var e=function(){return function(c){this.navigateAwayMessage=c}}();c.BaseEditSettings=e;e=function(d){function a(a){var b=this;d.call(this);$("form").areYouSure({message:a.navigateAwayMessage,fieldEvents:"change",dirtyClass:c.CssClasses.AreYouSure.Dirty}).on("clean.areYouSure",function(){b.hasChanges=!0});$(document).ajaxError(function(){b.hasChanges&&$("form").addClass(c.CssClasses.AreYouSure.Dirty)})}__extends(a,d);return a}(c.Base);c.BaseEdit=e})(Assignment||(Assignment={}));
(function(c){(function(a){a[a.ContinueWithoutSave=0]="ContinueWithoutSave";a[a.SaveAndContinue=1]="SaveAndContinue";a[a.Cancel=2]="Cancel"})(c.LeaveAction||(c.LeaveAction={}));var e=c.LeaveAction,d=function(){function a(a,c,d){this.terms=a;this.getInitValuesFunc=c;this.getActualDataFunc=d}a.prototype.checkCanILeave=function(){var a=$.Deferred();if(this.compare())a.resolve(e.ContinueWithoutSave);else{var c=new CCL.ConfirmButtonMetaData(this.terms.SaveAndContinueButtonText,"ccl-button-color-green",
"SaveAndContinue"),d=new CCL.ConfirmButtonMetaData(this.terms.ContinueWithoutSaveButtonText,"","ContinueWithoutSave"),k=new CCL.ConfirmButtonMetaData(this.terms.CancelButtonText,"","Cancel");$.alerts&&"boolean"===typeof $.alerts.draggable&&($.alerts.draggable=!1);CCL.CommonFunctions.jAjaxMultiButtonConfirm(this.terms.Message?this.terms.Message:"",this.terms.Title?this.terms.Title:"",[c,d,k],function(b){switch(b.customId){case "SaveAndContinue":a.resolve(e.SaveAndContinue);break;case "ContinueWithoutSave":a.resolve(e.ContinueWithoutSave);
break;default:a.resolve(e.Cancel)}});c=$("#popup_container");0<c.length&&c.keyup(function(b){b.which===CCL.CommonConstants.keyCodes.escape&&(b.stopPropagation(),$.alerts._hide(),a.resolve(e.Cancel))})}return a.promise()};a.prototype.bindBrowserEvents=function(){if(this.browserEventsAreBinded)console.warn("You can't double bind browser events");else{var a=$.proxy(this.browserEventsHandler,this);$(window).on("beforeunload",a);this.browserEventsAreBinded=!0}};a.prototype.unbindBrowserEvents=function(){var a=
$.proxy(this.browserEventsHandler,this);$(window).off("beforeunload",a);this.browserEventsAreBinded=!1};a.prototype.browserEventsHandler=function(a){return this.compare()?void 0:this.terms.Message};a.prototype.compare=function(){var a=this.getActualDataFunc(),c=this.getInitValuesFunc();return c&&a?a===c:!0};return a}();c.ForgotToSave=d})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.terms.navigateAway));this.errorAnswerTooShortForPlagiarism=14;this.errorFilesAreNotValidForPlagiarism=15;this.bindEvent=function(){b.isAnswerOnBehalfOfTheStudent?(b.$answerOnBehalfOfTheStudentSaveButton.click(b.onSubmitAnswerClick),b.$answerOnBehalfOfTheStudentCancelButton.click(!0,b.onCancelClick.bind(b))):(b.$buttonSave.click(b.onSubmitAnswerClick),b.$buttonSaveDraft.click(!0,b.onSubmitAnswerClick),b.$buttonCancel.click(!0,
b.onCancelClick.bind(b)))};this.getEditorContent=function(){return GetTextEditorContent(b.settings.controls.editorClientInstanceId)};this.onSubmitAnswerClick=function(a){b.handleError(!1);var c=b.getEditorContent(),d=b.getPressedButton(a.data),f=window.document.getElementById(b.settings.controls.uploadAreaClientId)[b.settings.controls.uploadControlClientInstanceName];if(!f)throw Error("Instance of the file uploader is not found.");f=f.uploadedItems;b.$feedbackForFiles.style.display="none";b.$feedbackForShortAnswer.style.display=
"none";b.feedbackForLongAnswer.style.display="none";var e=0<f.uploadMetadataArray.length+f.fileInCloudMetadataArray.length;0!==c.length||e?(b.$feedbackForEmptyAnswer.hide(),c.length>b.settings.data.textMaxLength)?(b.feedbackForLongAnswer.style.display="block",b.feedbackForLongAnswer.scrollIntoView(!0),d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)):!b.settings.data.isPlagiarismEnabled||a.data||b.validateAnswerForPlagiarismRules(f,c)?b.onGoingSaveRequest||(b.onGoingSaveRequest=CCL.CommonFunctions.safeAjaxPost({url:b.settings.urls.saveAnswerUrl,
data:{assignmentInstanceId:b.settings.data.assignmentInstanceId,assignmentId:b.settings.data.assignmentId,text:c,isDraft:a.data?!0:!1,UploadedItems:f,onBehalfOfUserId:b.settings.data.onBehalfOfUserId,isEditMode:b.settings.data.isEditMode,originalContext:b.settings.data.originalContext}}).done(b.onAnswerSaveDone).fail(b.onAnswerSaveFail,function(){d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)}).always(function(){b.onGoingSaveRequest=null})):d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator):
(b.$feedbackForEmptyAnswer.show(),b.$feedbackForEmptyAnswer[0].scrollIntoView(!0),d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};this.onAnswerSaveDone=function(a){CCL.CommonFunctions.isIe()?(a=document.createEvent("Event"),a.initEvent(b.settings.data.textEditorAutoSaveClearLocalStorageDataEventName,!0,!0),document.dispatchEvent(a)):document.dispatchEvent(new Event(b.settings.data.textEditorAutoSaveClearLocalStorageDataEventName));b.settings.data.isOpenedInIframe?(b.triggerEventOnParentDocument(c.Constants.Events.AnswerSaved),
b.triggerEventOnParentDocument(c.Constants.Events.AnswerViewingFinished)):(b.postMessageToShowSettings(!0),document.location.href=b.settings.urls.returnUrl)};this.onAnswerSaveFail=function(a){if(0===a.status)b.showErrorMessage(b.settings.terms.noInternetConnection);else try{var c=JSON.parse(a.responseText);b.handleError(!0,c)}catch(l){b.handleError(!0,null,b.settings.terms.cannotSaveAnswer)}};this.settings=a;this.isAnswerOnBehalfOfTheStudent=this.settings.data.isAnswerOnBehalfOfTheStudent;this.settings.data.isOpenedInIframe||
this.postMessageToHideSettings();this.$feedbackForError=$(this.settings.controls.feedbackForError);this.$feedbackForEmptyAnswer=$(this.settings.controls.feedbackForEmptyAnswer);this.$feedbackForShortAnswer=document.getElementById(this.settings.controls.feedbackForShortAnswer);this.feedbackForLongAnswer=document.getElementById(this.settings.controls.feedbackForLongAnswer);this.$feedbackForFiles=document.getElementById(this.settings.controls.feedbackForFiles);this.$buttonSave=$(this.settings.controls.buttonSave);
this.$buttonSaveDraft=$(this.settings.controls.buttonSaveDraft);this.$buttonCancel=$(this.settings.controls.buttonCancel);this.$answerOnBehalfOfTheStudentSaveButton=$(this.settings.controls.answerOnBehalfOfTheStudentSaveButton);this.$answerOnBehalfOfTheStudentCancelButton=$(this.settings.controls.answerOnBehalfOfTheStudentCancelButton);this.bindEvent();new CCL.ButtonLoadingIndicator(this.$buttonSave,this.settings.data.inProgressClass,[this.$buttonSaveDraft],0);new CCL.ButtonLoadingIndicator(this.$buttonSaveDraft,
this.settings.data.inProgressClass,[this.$buttonSave],0);new CCL.ButtonLoadingIndicator(this.$answerOnBehalfOfTheStudentSaveButton,this.settings.data.inProgressClass,null,0);CCL.IframeContentHeightReporter.addSelectorToListenHeight("#"+this.settings.controls.fileDialogContainer);var e=this;window.onload=function(a){(a=document.getElementsByClassName("ccl-uc-upload-area"))&&a[0]&&a[0].insertAdjacentElement("afterend",e.$feedbackForFiles)}}__extends(a,d);a.prototype.showErrorMessage=function(a){this.$feedbackForError.show().find(".ccl-feedback-text").text(a);
this.$feedbackForError[0].scrollIntoView(!0)};a.prototype.handleError=function(a,c,d){if(c){if(a&&c.CustomErrorCode===this.settings.plagiarismErrors.textTooShort){this.$feedbackForShortAnswer.style.display="block";this.$feedbackForShortAnswer.scrollIntoView(!0);return}if(a&&c.CustomErrorCode===this.settings.plagiarismErrors.filesNotValid){this.$feedbackForFiles.style.display="block";this.$feedbackForFiles.scrollIntoView(!0);return}this.showErrorMessage(c.ErrorMessage)}d&&this.showErrorMessage(d);
this.$feedbackForError.toggle(a)};a.prototype.hasValidFilesForPlagiarism=function(a){return!this.settings.data.isPlagiarismEnabled||this.hasValidFiles(a.uploadMetadataArray)||this.hasValidFiles(a.fileInCloudMetadataArray)?!0:!1};a.prototype.hasValidFiles=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.name&&this.isFileValidForPlagiarism(c))return!0}return!1};a.prototype.onFileChanged=function(){if(!this.settings.data.isPlagiarismEnabled)return!0;var a=window.document.getElementById(this.settings.controls.uploadAreaClientId)[this.settings.controls.uploadControlClientInstanceName];
if(!a)throw Error("Instance of the file uploader is not found.");a=a.uploadedItems;var c=GetTextEditorContent(this.settings.controls.editorClientInstanceId);this.validateAnswerForPlagiarismRules(a,c)};a.prototype.validateAnswerForPlagiarismRules=function(a,c){var b=!0,d=0<a.uploadMetadataArray.length+a.fileInCloudMetadataArray.length;a=this.hasValidFilesForPlagiarism(a);(c=0<=c.length&&c.length<=this.settings.data.textMinLength)&&!d?(this.$feedbackForShortAnswer.style.display="block",this.$feedbackForShortAnswer.scrollIntoView(!0),
b=!1):this.$feedbackForShortAnswer.style.display="none";c&&d&&!a?(this.$feedbackForFiles.style.display="block",this.$feedbackForFiles.scrollIntoView(!0),b=!1):this.$feedbackForFiles.style.display="none";return b};a.prototype.isFileValidForPlagiarism=function(a){var b=a.name.slice((a.name.lastIndexOf(".")-1>>>0)+2).toLowerCase();return-1!==this.settings.data.supportedPlagiarismExtensions.indexOf(b)||this.isMimeTypeSupportedForPlagiarism(a.mimeType)};a.prototype.isMimeTypeSupportedForPlagiarism=function(a){return-1!==
this.settings.data.googleMimeTypesConvertibleToPdf.indexOf(a)};a.prototype.getPressedButton=function(a){return this.isAnswerOnBehalfOfTheStudent?this.$answerOnBehalfOfTheStudentSaveButton:a?this.$buttonSaveDraft:this.$buttonSave};a.prototype.onCancelClick=function(a){a.preventDefault();this.settings.data.isOpenedInIframe?this.triggerEventOnParentDocument(c.Constants.Events.AnswerClosed):(this.postMessageToShowSettings(),document.location.href=this.settings.urls.returnUrl)};a.prototype.triggerEventOnParentDocument=
function(a,c){void 0===c&&(c=null);parent&&parent.$(parent.document).trigger(a,c)};return a}(c.BaseEdit);c.Answer=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){d.call(this,new c.BaseEditSettings(a.data.navigateAwayMessage));this.settings=a;new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.inProgressClass);$(this.settings.controls.okButtonSelector).click(this.handler.bind(this));$(this.settings.controls.manageRubricLinkSelector).click(this.showManageRubricHandler.bind(this))}__extends(a,d);a.prototype.showManageRubricHandler=function(){CCL.CommonFunctions.makePostMessageCall(window.parent,
{messageName:CCL.CommonWindowMessages.MessageNames.assignmentShowManageRubric})};a.prototype.handler=function(){!1===window.Page_IsValid&&$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};return a}(c.BaseEdit);c.AddEdit=e})(Assignment||(Assignment={}));
var BaseMetadata=function(){return function(c,e,d){this.name=c;this.sourceType=e;this.mimeType=d}}(),LocalFileInputHandle=function(){function c(c){this.fileInput=c}c.prototype.get=function(){return this.fileInput};return c}(),LocalFileHandle=function(){function c(c){this.file=c}c.prototype.get=function(){return this.file};return c}(),ExternalSourceFileHandle=function(){function c(c,d,a,b){this.url=c;this.id=d;this.canBeCopied=a;this.canBeShared=b}c.prototype.get=function(){return objectState.isNullOrUndefined(this.id)?
this.url:{url:this.url,id:this.id,canBeCopied:null==this.canBeCopied?!0:this.canBeCopied,canBeShared:null==this.canBeShared?!0:this.canBeShared}};return c}(),SourceType;(function(c){c[c.Dropbox=1]="Dropbox";c[c.Google=2]="Google";c[c.OneDriveForBusiness=3]="OneDriveForBusiness";c[c.Local=4]="Local";c[c.OneDrivePersonal=5]="OneDrivePersonal";c[c.WebDav=6]="WebDav";c[c.Ziggeo=7]="Ziggeo"})(SourceType||(SourceType={}));
(function(c){c.isOneDrive=function(e){return e===c.OneDrivePersonal||e===c.OneDriveForBusiness};c.isCloud=function(e){return e===c.Dropbox||e===c.Google||c.isOneDrive(e)||e===c.WebDav||e===c.Ziggeo}})(SourceType||(SourceType={}));
var FileInOneDriveHandle=function(){function c(c){this.postMessageFile=c}c.prototype.get=function(){return objectState.isNullOrUndefined(this.postMessageFile.id)?this.postMessageFile.url:{url:this.postMessageFile.url,viewUrl:this.postMessageFile.viewUrl,downloadUrl:this.postMessageFile.downloadUrl,id:this.postMessageFile.id,canBeCopied:null==this.postMessageFile.canBeCopied?!0:this.postMessageFile.canBeCopied,canBeShared:null==this.postMessageFile.canBeShared?!0:this.postMessageFile.canBeShared}};
return c}(),PickerFileResult=function(){function c(c,d,a,b,f,g){this.fileHandle=c;this.name=d;this.size=a;this.sourceType=b;this.relativePath=f;this.mimeType=g}c.prototype.getFileHandle=function(){return this.fileHandle.get()};c.createExternalSourcePickerFileResult=function(e,d,a,b,f,g,k,h){return new c(new ExternalSourceFileHandle(e,g,k,h),d,a,b,null,f)};c.createLocalPickerFileResultWithInput=function(e,d){return new c(new LocalFileInputHandle(e),d,null,SourceType.Local)};c.createLocalPickerFileResult=
function(e){return new c(new LocalFileHandle(e),e.name,e.size,SourceType.Local,null,e.type)};c.createFolderPickerFileResultWithRelativePath=function(e,d){return new c(new LocalFileHandle(e),e.name,e.size,SourceType.Local,d,e.type)};c.createPickerFileResultWithFileName=function(e){return new c(new LocalFileHandle(null),e,0,SourceType.Local,null,null)};c.createOneDrivePickerFileResult=function(e){return new c(new FileInOneDriveHandle(e),e.name,e.size,e.sourceType,null,e.mimeType)};return c}(),UploadMetadata=
function(c){function e(d,a,b,f,e,k,h,l,m){c.call(this,a,b,k);this.id=d;this.name=a;this.sourceType=b;this.signature=f;this.signedFileRepoId=e;this.mimeType=k;this.isTemplate=h;this.customId=l;this.originalFileId=m}__extends(e,c);e.castMetadataObjectToUploadMetadata=function(c){return new e(c.id,c.name,c.sourceType,c.signature,c.signedFileRepoId,c.mimeType,!1,c.customId,c.originalFileId)};e.updateName=function(c,a){c.name=a};e.setTemplate=function(c,a){c.isTemplate=a};e.create=function(c,a){var b=
c.name,d=c.sourceType,g=c.mimeType,k=null,h=null,l=null,m=null;c=c.getFileHandle().id;a&&(a.fileGuid&&(k=a.fileGuid),a.signedGuid&&(h=a.signedGuid),a.signedFileRepoId&&(l=a.signedFileRepoId),a.mimeType&&(g=a.mimeType),a.customId&&(m=a.customId));return new e(k,b,d,h,l,g,!1,m,c)};return e}(BaseMetadata);(function(c){var e=function(c){function a(a){c.call(this)}__extends(a,c);return a}(c.Base);c.AnswerTemplate=e})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(a){var b=this;this.addComment=function(a,c,d,f,e,n){CCL.CommonFunctions.safeAjaxPost({dataType:"json",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,assignmentInstanceAnswerId:c.AssignmentInstanceAnswerId,commentType:c.CommentType,text:d,lastVisibleCommentId:f},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,
headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){e(a,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){n&&"function"===typeof n&&n(a,b)})};this.editComment=function(a,c,d,f,e,n){CCL.CommonFunctions.safeAjax({type:"PUT",dataType:"json",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,commentId:d,text:f},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,
headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){e(a,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){n(a,d,b)})};this.deleteComment=function(a,c,d,f,e){CCL.CommonFunctions.safeAjax({type:"DELETE",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,commentId:d},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){f(a,
d,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){e(a,d,b)})};this.loadOld=function(a,c,d,f,e,n,p){$.ajax({type:"GET",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,assignmentInstanceAnswerId:c.AssignmentInstanceAnswerId,commentType:c.CommentType,commentId:d,count:f,numberOfPreviouslyReadItemsToDisplay:e}}).done(function(c){b.settings.ShowCommentModuleIfNoCommentsExist||0<c.Items.length?n(a,c):a.hide();
$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){p&&"function"===typeof p&&p(a,b)})};window[a]=this}a.prototype.initialize=function(a){this.settings=a;this.commentModuleChangeEvent=a.CommentModuleChangeEvent};return a}();c.CommentModuleManagerWrapper=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(a){this.settings=a;window[c.Constants.ClientInstanceNames.AllInOneGraderAnswer]=this;var b=$("#"+a.FileViewerEllipsisButtonIdentifier);this.answerSubmitOnBehalfControl=new e.AnswerSubmitOnBehalf(this.settings.SubmitOnBehalfSettingsModel);if(this.settings.HasAnswer){var d=$("#"+c.Constants.ClientIds.AnswerContainer),k=$("#"+c.Constants.ClientIds.AnswerFileViewer);Tools.ExpandableSection.attachHandlerOnContainer(d);k.on("click","."+c.CssClasses.FileViewer.BackLink,
function(){k.hide().empty();d.show();document.dispatchEvent(new Event(c.Constants.Events.AnswerViewingFinished))});a.ShowActionMenu&&b.get(0)&&this.createActionMenu(b);this.plagiarismStatusUpdater=new c.PlagiarismStatusUpdater(this.settings.AnswerId,this.settings.AnswerPlagiarismSettings.SetUsePlagiarismUrl,this.settings.PlagiarismStatusUpdaterSettings);this.settings.PlagiarismStatusUpdaterSettings&&this.settings.PlagiarismStatusUpdaterSettings.HasAnyPlagiarismReportsInProcessing&&this.plagiarismStatusUpdater.attachUpdater()}}
a.getInstance=function(){return window[c.Constants.ClientInstanceNames.AllInOneGraderAnswer]};a.loadViewer=function(a){c.AllInOneGrader.waitForAnswerOrFile();$.ajax({type:"GET",url:a}).done(function(a){$("#"+c.Constants.ClientIds.AnswerContainer).hide();$("#"+c.Constants.ClientIds.AnswerFileViewer).show().html(a)}).fail(function(a,b,d){c.AllInOneGrader.endWaitForAnswerOrFile();console.error(d)})};a.prototype.clear=function(){this.plagiarismStatusUpdater&&this.plagiarismStatusUpdater.removeUpdater()};
a.prototype.createActionMenu=function(a){var b=this;this.actionMenu=new CCL.ActionMenu(a,null,new CCL.ActionMenuSettings(CCL.ActionMenuHorizontalPosition.Left,CCL.ActionMenuOpeningMode.Click,c.Constants.AllInOneGraderActionMenuZIndex,!0,!0));if(this.settings.AnswerPlagiarismSettings.CanSendAnswerForPlagiarism||this.settings.AnswerPlagiarismSettings.AllowResendForPlagiarism)this.plagiarismMenuItem=new CCL.ActionMenuItem("","SendPlagiarism",function(){c.PlagiarismReport.setUsePlagiarism(b.settings.AnswerId,
b.plagiarismMenuItem,b.settings.AnswerPlagiarismSettings,b.plagiarismStatusUpdater)}),c.PlagiarismReport.updatePlagiarismMessage(this.plagiarismMenuItem,this.settings.AnswerPlagiarismSettings),this.actionMenu.addItem(this.plagiarismMenuItem);this.settings.SubmitOnBehalfSettingsModel.SubmitOnBehalhUrl&&(a=new CCL.ActionMenuItem(this.settings.SubmitOnBehalfSettingsModel.EditAnswerTerm,"EditAnswer",this.answerSubmitOnBehalfControl.openSubmitOnBehalfDialog),this.actionMenu.addItem(a));this.settings.PlagiarismReportUrl&&
(a=new CCL.ActionMenuItem(this.settings.Terms.OpenPlagiarismReport,"OpenPlagiarismReport",function(){c.PlagiarismReport.openPlagiarismReport(b.settings.PlagiarismReportUrl)}),this.actionMenu.addItem(a));this.settings.PrintSettingsModel&&(a=new CCL.ActionMenuItem(this.settings.PrintSettingsModel.PrintTerm,"Print",function(){return window.print()}),this.actionMenu.addItem(a));$("."+c.CssClasses.Grader.AnswerContainer).scroll(function(){b.actionMenu.close()})};return a}();e.Answer=d})(c.Controls||(c.Controls=
{}))})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.data.terms.navigateAwayMessage));this.postMessageToHideSettings();this.settings=a;this.$saveAndAssessButton=$(this.settings.controls.saveAndAssessNextButtonSelector);this.$submitButton=$(this.settings.controls.okButtonSelector);this.commentModule=$("#"+this.settings.controls.commentModule).getCommentModuleObject();this.teacherNoteModule=$("#"+this.settings.controls.teacherNoteModule).getCommentModuleObject();this.commentsAndTeacherNotesContainer=
$("#"+this.settings.controls.commentsAndTeacherNotesContainer);this.$commentsContainer=$('[data-contentid="#'+this.settings.controls.commentsContainer+'"]');this.$teacherNotesContainer=$('[data-contentid="#'+this.settings.controls.teacherNotesContainer+'"]');this.$commentTabs=$("#"+this.settings.controls.commentTabs);this.$filesSection=$("#"+this.settings.controls.filesSection);var e=document.getElementById(this.settings.controls.answerFileList);e&&e.addEventListener(this.settings.data.openPlagiarismReportEvent,
function(a){return c.FileList.openPlagiarismReport(a)});new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.saveAndAssessNextButtonSelector]);new CCL.ButtonLoadingIndicator(this.settings.controls.saveAndAssessNextButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.okButtonSelector]);this.$submitButton.click(this.handler.bind(this));this.$saveAndAssessButton.click(this.handler.bind(this));
this.settings.controls.annotateFilesOnboardingDialog&&(new c.Onboarding.Step(this.settings.data.onboardingCssClasses,this.settings.controls.annotateFilesOnboardingDialog,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAnnotateAnswerFiles)).start();0<this.$commentTabs.length?(this.$commentTabs.on(CCL.ControlTabsEvent.TabIndexChanged,function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];c=c[0].selectedTab;c===b.settings.data.commentsTabIndex?b.loadCommentModule(b.commentModule):
c===b.settings.data.teacherNotesTabIndex&&b.loadCommentModule(b.teacherNoteModule);b.changeCommentModuleNoPrintClass()}),this.loadCommentModule(this.commentModule)):this.commentModule?(this.loadCommentModule(this.commentModule),this.changeCommentModuleNoPrintClass()):this.teacherNoteModule&&(this.loadCommentModule(this.teacherNoteModule),this.changeCommentModuleNoPrintClass());$(this.commentModule).add(this.teacherNoteModule).on(this.settings.data.commentModuleChangeEvent,function(){return b.changeCommentModuleNoPrintClass()});
$("#"+this.settings.controls.requestPlagiarismReportLink).on("click",function(){b.setUsePlagiarism(!0)});$("#"+this.settings.controls.requestPlagiarismReportCancelLink).on("click",function(){b.setUsePlagiarism(!1)});$(document).on(a.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(a.urls.measureKpi,a.data.kpi.measureSection,a.data.kpi.measurement)},this))}__extends(a,d);a.prototype.handler=function(){!1===window.Page_IsValid&&(this.$submitButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator),
this.$saveAndAssessButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};a.prototype.loadCommentModule=function(a){a&&!a.isDataSourceFetchedAtLeastOnce()&&a.loadAndShow();this.currentCommentModule=a};a.prototype.changeCommentModuleNoPrintClass=function(){var a=this.currentCommentModule;this.commentsAndTeacherNotesContainer.add(this.$commentsContainer).add(this.$teacherNotesContainer).removeClass(this.settings.data.cssClasses.noPrint);0<a.getCommentsCountWithoutDeleted()?a===this.commentModule?
this.$teacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint):a===this.teacherNoteModule&&this.$commentsContainer.addClass(this.settings.data.cssClasses.noPrint):this.commentsAndTeacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint)};a.prototype.togglePlagiarismMessage=function(){$("#"+this.settings.controls.requestPlagiarismReport).add("#"+this.settings.controls.requestPlagiarismReportCancel).toggle()};a.prototype.setUsePlagiarism=function(a){var b=this;CCL.CommonFunctions.safeAjax({url:this.settings.urls.setUsePlagiarism,
type:"PUT",dataType:"json",data:{answerId:this.settings.data.answerId,usePlagiarism:a}}).done(function(){b.togglePlagiarismMessage()})};return a}(c.BaseEdit);c.AssessAnswer=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a,f){d.call(this,new c.BaseEditSettings(f.Terms.NavigateAway));window[a]=this;this.settings=f;this.$validationError=$(this.settings.Controls.ValidationError)}__extends(a,d);a.prototype.validate=function(){this.assessmentControl=window[this.settings.Controls.AssessmentControlInstance];var a=!0;("undefined"!==typeof Page_ClientValidate?Page_ClientValidate():1)?this.settings.IsFeedbackMandatory&&IsEditorEmpty(this.settings.Controls.TextEditorClientId)&&this.isUploadedFilesListEmpty()?
a=!1:this.settings.IsFeedbackMandatory||!this.isAssessmentEmpty()||this.isScoreValid()||(a=!1):a=!1;this.$validationError.toggle(!a);a||this.$validationError.get(0).scrollIntoView();return a};a.prototype.isAssessmentEmpty=function(){var a=this.assessmentControl.getAssessment();return void 0===a||"0"===a||""===a};a.prototype.isScoreValid=function(){var a=this.assessmentControl.getScore();return a&&0<=parseFloat(a)};a.prototype.isUploadedFilesListEmpty=function(){var a=window.document.getElementById(this.settings.Controls.UploadAreaClientId)[this.settings.Controls.UploadControlClientInstanceName];
if(!a)throw Error("Instance of the file uploader is not found.");a=a.uploadedItems;return 0===a.uploadMetadataArray.length+a.fileInCloudMetadataArray.length};return a}(c.BaseEdit);c.AssessPeer=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.ClientInstanceNames={AllInOneGrader:"AllInOneGrader",AllInOneGraderDialog:"AllInOneGraderDialog",ReviewPeerAssessmentDialog:"ReviewPeerAssessmentDialog",RubricAssessment:"AssignmentRubricAssessment",HybridEditor:"AssignmentHybridEditor",AllInOneGraderAnswer:"AllInOneGraderAnswer"};c.ClientIds={AllInOneGraderHeaderNext:"as-grader-header-next-button-id",AllInOneGraderHeaderPrevious:"as-grader-header-previous-button-id",AllInOneGraderContent:"as-grader-content-id",
AnswerContainer:"as-answer-container-id",PlagiarismReportLinkContainer:"as-plagiarism-report-link-container-id",AnswerFileViewer:"as-answer-file-viewer-container-id",GraderLoadingIndicator:"as-grader-loading-indicator-id",AnswerOrFileLoadingIndicator:"as-answer-or-file-loading-indicator-id"};c.Events={PlagiarismRequestCancel:"assessment:plagiarismrequestcancel",PlagiarismRequested:"assessment:plagiarismrequested",AssessmentSaved:"assessment:saved",AssessmentSaveFailed:"assessment:savefailed",RubricAssessmentClosed:"rubricAssessment:closed",
AnswersGridDataChanged:"answersgrid:datachanged",AnswerSaved:"answer:saved",AnswerRefresh:"answer:refresh",AnswerClosed:"answer:closed",PlagiarismStatusChanged:"assessment:plagiarismstatuschanged",AnswerViewingFinished:"answer:viewingfinished",AnnotationDrawingActive:"annotation:drawingactive"};c.RequestParams={AnswerId:"AnswerId",IsLastAnswerAssessed:"IsLastAnswerAssessed"};c.ScoreAllowedCharacters=[CCL.CommonConstants.keyCodes.del,CCL.CommonConstants.keyCodes.backspace,CCL.CommonConstants.keyCodes.tab,
CCL.CommonConstants.keyCodes.escape,CCL.CommonConstants.keyCodes.enter,CCL.CommonConstants.keyCodes.comma,CCL.CommonConstants.keyCodes.period,CCL.CommonConstants.keyCodes.decimalPoint,CCL.CommonConstants.keyCodes.shift];c.UserSettingsKey={IsGoogleDocOnboardingCompleted:"IsGoogleDocOnboardingCompleted"};c.DataAttributes={FileId:"data-file-id",AnswerId:"data-answer-id"};c.PdfJsZIndex=1E4;c.AllInOneGraderActionMenuZIndex=c.PdfJsZIndex+1;return c}();c.Constants=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.AreYouSure={Dirty:"as-dirty"};c.FileViewer={ContentContainer:"as-file-viewer-content",BackLink:"as-file-viewer-back-link"};c.Common={PersonProfileImage:"as-profile-picture-large",InformationFeedbackMessage:"as-info-feedback-message",Widont:"as-widont"};c.AddPeerDialog={Row:"as-add-peers-row",Image:"as-peer-image",Name:"as-peer-name",Remove:"as-remove-peer-link"};c.AutocompleteMenu={Menu:"as-autocomplete-menu"};c.Grader={Content:"as-grader-content",HeaderPersonReferenceContainer:"as-grader-header-person-reference-container",
ShowSidebarButton:"as-grader-show-sidebar-button",HideSidebarButton:"as-grader-hide-sidebar-button",AnswerContainer:"as-grader-answer-container",AnswerOrFileViewer:"as-grader-answer-or-file",DisabledNavigationButtons:"as-grader-header-navigation-disabled",LoadingIndicator:"as-grader-loading-indicator",AnswerPlagiarismReportPlaceholder:"as-answer-plagiarism-report-placeholder",FilePlagiarismReportPlaceholder:"as-file-plagiarism-report-placeholder"};c.Assessment={ValidationError:"as-assessment-validationerror",
ValidationErrorMessage:"as-assessment-validationerror-message",ReadMode:"as-assessment-read-mode",Mandatory:"as-mandatory",MandatoryLabel:"as-mandatory-field-label"};c.ExpandableSection={Section:"as-expandable-section",Arrow:"as-expandable-arrow"};return c}();c.CssClasses=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(a){var b=this;this.settings=a;this.openSubmitOnBehalfDialog=function(){var a=window[b.settings.SubmitOnBehalfDialogClientInstanceName];a.setIframeUrl(b.settings.SubmitOnBehalhUrl,!1);a.openDialog(!1)};this.attachSubmitOnBehalfEvents()}a.prototype.attachSubmitOnBehalfEvents=function(){this.settings.SubmitOnBehalhUrl&&($("#"+this.settings.SubmitOnBehalfLinkId).on("click",this.openSubmitOnBehalfDialog),$(document).off(c.Constants.Events.AnswerClosed).on(c.Constants.Events.AnswerClosed,
function(){return CssModal.closeDialog()}),$(document).off(c.Constants.Events.AnswerSaved).on(c.Constants.Events.AnswerSaved,function(){CssModal.closeDialog();$(document).trigger(c.Constants.Events.AnswerRefresh)}))};return a}();e.AnswerSubmitOnBehalf=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.settings=a;window[d.clientInstanceName]=this;this.$score=$("#"+this.settings.Controls.ScoreClientId);this.$assessmentItems=$("#"+this.settings.Controls.AssessmentItemsClientId);this.$assessmentStatusItems=$("#"+this.settings.Controls.AssessmentStatusItemsClientId);this.$feedback=$("#"+this.settings.Controls.FeedbackClientId);this.$completeMenuLink=$("#"+this.settings.Controls.CompleteMenuLinkClientId);this.$completed=$("#"+this.settings.Controls.CompleteHiddenClientId);
this.$feedbackText=$("#"+this.settings.Controls.FeedbackTextClientId);this.$feedbackBlock=$("#"+this.settings.Controls.FeedbackBlockClientId);this.$contentContainer=$("."+this.settings.CssClasses.ContentContainer);this.$saveAssessmentButton=$("#"+a.Controls.SaveAssessmentClientId).click(function(a){a.preventDefault();b.onSaveClick()});$("#"+a.Controls.EditAssessmentClientId).click(function(){return b.toggleReadEditMode(!1)});$("#"+a.Controls.CompleteLinkClientId).click(function(){return b.setComplete(!0)});
$("#"+a.Controls.IncompleteLinkClientId).click(function(){return b.setComplete(!1)});$("."+a.Controls.AssessmentStatusLinkClientId).click(function(a){b.$assessmentStatusItems.text($(a.currentTarget).text());b.$assessmentStatusItems.attr("data-status-id",$(a.currentTarget).attr("data-status-id"))});this.rubricAssessmentControl=c.Controls.RubricAssessment.getInstance;this.attachRubricAssessmentEvents();this.initFeedbackTextExpander();this.$score.keydown(function(a){return b.onScoreKeyDown(a)});this.hybridEditorItemWrapper=
c.HybridEditorItemWrapper.getInstance;this.hybridEditorItemWrapper.connectHybridEditor();this.initValues=this.getDataToSave()}d.prototype.initFeedbackTextExpander=function(){d.feedbackTextExpander=new CCL.ContentBlockExpander(this.$feedbackText,this.settings.FeedbackExpanderSettingsModel)};d.getInstance=function(){return window[d.clientInstanceName]};Object.defineProperty(d.prototype,"isFeedbackAreaInFocus",{get:function(){return 0<this.$feedback.find("textarea:focus").length},enumerable:!0,configurable:!0});
d.prototype.clear=function(){this.clearUploader();this.rubricAssessmentControl&&this.rubricAssessmentControl.clear()};d.prototype.save=function(){var a=$.Deferred();if(!this.isValid())return a.reject({isValidationError:!0}),a.promise();CCL.CommonFunctions.safeAjaxPost({url:this.settings.PostUrl,data:this.getDataToSave(),dataType:"json"}).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)});return a.promise()};d.prototype.getDataToSave=function(){var a=null;this.uploadControlInstance&&(a=
this.uploadControlInstance.uploadedItems);return{Score:this.$score.val(),AssessmentItemId:+this.$assessmentItems.val(),FeedbackTextValue:encodeURIComponent($.trim(this.hybridEditorItemWrapper.getText())),FeedbackTextHtml:"",Completed:this.$completed.val()===(!0).toString(),AssessmentStatusItemId:+this.$assessmentStatusItems.attr("data-status-id"),UploadedItems:a,LearningObjectiveAssessments:this.rubricAssessmentControl.get(this.settings.UserId)}};d.prototype.updateInlineEditorText=function(){this.hybridEditorItemWrapper.updateInlineEditorText()};
Object.defineProperty(d.prototype,"uploadControlInstance",{get:function(){var a=this.uploadArea;return a?a[this.settings.Controls.UploadControlClientInstanceName]:null},enumerable:!0,configurable:!0});d.prototype.clearUploader=function(){var a=this.uploadControlInstance;a&&a.dispose()};d.prototype.onSaveClick=function(){var a=this;this.save().done(function(b){a.toggleReadEditMode(!0,b);$(document).trigger(c.Constants.Events.AssessmentSaved);a.initValues=a.getDataToSave()}).fail(function(b){$(document).trigger(c.Constants.Events.AssessmentSaveFailed,
[b,function(){a.onSaveClick()}])})};d.prototype.isValid=function(){if(this.$completed.val()===(!0).toString()){if(!d.validateInput(this.$score,"")||!d.validateInput(this.$assessmentItems,"0"))return!1}else this.clearValidationErrors();return!0};d.prototype.clearValidationErrors=function(){this.$score.add(this.$assessmentItems).removeClass(c.CssClasses.Assessment.ValidationError);$("."+c.CssClasses.Assessment.ValidationErrorMessage).hide()};d.validateInput=function(a,b){return 0<a.length?(b=a.val()!==
b,a.toggleClass(c.CssClasses.Assessment.ValidationError,!b),$("."+c.CssClasses.Assessment.ValidationErrorMessage,a.parent()).toggle(!b),b):!0};d.prototype.setComplete=function(a){this.$completed.val(a.toString());this.toggleMandatory(a);a||this.clearValidationErrors();this.$completeMenuLink.text(a?this.settings.Terms.Complete:this.settings.Terms.Incomplete)};d.prototype.onScoreKeyDown=function(a){CCL.CommonFunctions.preventInputIncorrectCharacters(a,c.Constants.ScoreAllowedCharacters)};d.prototype.toggleMandatory=
function(a){this.settings.ShowMandatoryMarks&&(this.$contentContainer.find("."+c.CssClasses.Assessment.MandatoryLabel).toggleClass(c.CssClasses.Assessment.Mandatory,a),this.$score.add(this.$assessmentItems).attr("aria-required",a.toString()))};d.prototype.toggleReadEditMode=function(a,b){void 0===b&&(b=null);this.$contentContainer.toggleClass(c.CssClasses.Assessment.ReadMode,a);this.toggleFeedback(a,b?b.FeedbackTextHtml:null,b?b.FeedbackTextValue:null,b?b.HasFiles:!1);if(a){var d=this.uploadControlInstance;
d&&"function"===typeof d.removeFilesWithErrors&&d.removeFilesWithErrors();d=b.Score?b.Score:this.settings.Terms.NotAssessed;var e=this.$assessmentItems.find("option:selected").text();$("#"+this.settings.Controls.ScoreTextClientId).text(d);$("#"+this.settings.Controls.AssessmentItemsTextClientId).text(e);$("#"+this.settings.Controls.AssessmentStatusItemsTextClientId).text(this.$assessmentStatusItems.text());$("#"+this.settings.Controls.CompleteMenuLinkTextClientId).text(this.$completeMenuLink.text());
$("#"+this.settings.Controls.ReviewedByTextClientId).html(b.ReviewedByPersonReferenceHtml)}this.toggleMandatory(!a&&this.$completed.val()===(!0).toString())};d.prototype.toggleFeedback=function(a,b,c,e){a?b&&c?(this.$feedbackText.html(b),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$feedbackText),this.hybridEditorItemWrapper.setText(b,c),d.feedbackTextExpander.renderShowMoreLinkIfNeed(!1)):(this.$feedback.val(""),this.$feedbackText.text(""),this.hybridEditorItemWrapper.setText("",
""),e||this.$feedbackBlock.hide()):(this.$feedbackBlock.show(),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$feedbackText))};d.prototype.attachRubricAssessmentEvents=function(){var a=this;$("#"+this.settings.Controls.RubricButtonClientId).click(function(){a.rubricAssessmentControl.open(a.settings.UserId,a.settings.RubricAssessment,a.settings.RubricAssessmentsMasterySettings)&&(a.initValues.LearningObjectiveAssessments=a.rubricAssessmentControl.get(a.settings.UserId))});$("#"+
this.settings.Controls.ViewRubricLinkClientId).click(function(){a.rubricAssessmentControl.open(a.settings.UserId,a.settings.RubricAssessment,a.settings.RubricAssessmentsMasterySettings,!0)&&(a.initValues.LearningObjectiveAssessments=a.rubricAssessmentControl.get(a.settings.UserId))});$(document).on(c.Constants.Events.RubricAssessmentClosed,function(){a.rubricAssessmentControl.isEmpty(a.settings.UserId)||a.toggleRubricButton();a.changeAssessment(a.rubricAssessmentControl.getAssessment(a.settings.UserId));
a.changeScore(a.rubricAssessmentControl.getScore(a.settings.UserId))})};d.prototype.toggleRubricButton=function(){$("#"+this.settings.Controls.RubricButtonClientId).text(this.settings.Terms.EditRubric)};d.prototype.changeAssessment=function(a){null!=a&&this.$assessmentItems.val(a)};d.prototype.changeScore=function(a){null!=a&&this.$score.val(a)};Object.defineProperty(d.prototype,"uploadArea",{get:function(){return window.document.getElementById(this.settings.Controls.UploadAreaClientId)},enumerable:!0,
configurable:!0});d.clientInstanceName="AssignmentAssessmentControl";return d}();c.Assessment=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(a,c){var b=this;window[a]=this;this.settings=c;this.$completedToggle=$("#"+c.Controls.CompletedToggle);this.$scoreText=$("#"+c.Controls.Score);this.$assessment=$("#"+c.Controls.Assessment);this.$loAssessmentState=$("#"+c.Controls.LoAssessmentState);this.$rubricCriterias=$("#"+c.Controls.RubricCriterias);this.rubricToggleChangeValue=c.RubricToggleChangeValue;this.$simplifiedAssessmentStatusList=$("#"+c.Controls.SimplifiedAssessmentStatusList);var d=
$("#"+c.Controls.AssessmentOrScoreFeedback),f=$("#"+c.Controls.CompletedToggleLabel),e=$("#"+c.Controls.AssessmentLabel+", #"+c.Controls.ScoreLabel),m=$("#"+c.Controls.FieldIsMandatoryInformationMessage);this.$scoreText.add(this.$assessment).change(function(){d.hide()});this.$completedToggle.on(c.ToggleStateChangedEventName,function(a,d){a=window[d.toggleInstanceId];f.html(a.isChecked()?c.Terms.CompletedToggleOn:c.Terms.CompletedToggleOff);e.toggleClass(c.CssClasses.MandatoryMark,a.isChecked());m.toggle(a.isChecked());
b.$scoreText.add(b.$assessment).attr("aria-required",a.isChecked())});this.$loAssessmentState.change(function(){var a=b.$loAssessmentState.val()===b.rubricToggleChangeValue;b.$rubricCriterias.toggleClass(c.CssClasses.Hidden,!a)});this.$scoreText.on("keydown",function(a){return b.onScoreKeyDown(a)})}a.prototype.validateAssessmentForCompleted=function(a,c){this.isAsessmentMissingForCompleted()?c.IsValid=!1:c.IsValid=!0};a.prototype.getAssessment=function(){return this.$assessment.val()};a.prototype.getScore=
function(){return this.$scoreText.val()};a.prototype.isAsessmentMissingForCompleted=function(){var a=0<this.$completedToggle.length||0<this.$simplifiedAssessmentStatusList.length;return(this.$completedToggle.is(":checked")||this.$simplifiedAssessmentStatusList.val()===this.settings.CompletedStatusValue||!a)&&("0"===this.getAssessment()||""===this.getScore())};a.prototype.onScoreKeyDown=function(a){CCL.CommonFunctions.preventInputIncorrectCharacters(a,c.Constants.ScoreAllowedCharacters)};return a}();
e.AssessmentControl=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){this.hybridEditorClientId=a;this.hybridEditorItemClientId=b;this.$hybridEditorItem=null;window[d.clientInstanceName]||(window[d.clientInstanceName]=this)}Object.defineProperty(d,"getInstance",{get:function(){return window[d.clientInstanceName]},enumerable:!0,configurable:!0});d.prototype.connectHybridEditor=function(){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("connectHybridEditor",this.hybridEditorClientId)};d.prototype.getText=
function(){this.hybridEditorItem.hybridEditorItem();return this.hybridEditorItem.hybridEditorItem("value")};d.prototype.setText=function(a,b){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("updateTextContainer",a,b);CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.hybridEditorItem);window.loadIframelyEmbedJs&&window.loadIframelyEmbedJs()};d.prototype.updateInlineEditorText=function(){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("updateInlineEditorText")};
Object.defineProperty(d.prototype,"hybridEditorItem",{get:function(){return this.$hybridEditorItem?this.$hybridEditorItem:$("#"+this.hybridEditorItemClientId)},enumerable:!0,configurable:!0});d.clientInstanceName=c.Constants.ClientInstanceNames.HybridEditor;return d}();c.HybridEditorItemWrapper=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(b){var c=this;this.settings=b;this.assessment=this.score=null;window[a.clientInstanceName]||(window[a.clientInstanceName]=this);this.dialog=window[this.settings.Controls.DialogClientId];this.rubrics=window[this.settings.Controls.RubricsClientId];this.$saveButton=$("#"+this.settings.Controls.CloseButtonClientId);this.$saveButton.on("click",function(){c.close()})}Object.defineProperty(a,"getInstance",{get:function(){return window[a.clientInstanceName]},
enumerable:!0,configurable:!0});a.prototype.open=function(a,c,d,e){void 0===e&&(e=!1);var b=!1;$("span",this.dialog.getHeaderContainer()).toggle(!e);this.dialog.setTitle(e?this.settings.Terms.RubricAssessment:this.settings.Terms.AssessWithRubric);this.dialog.openDialog(!1);this.currentUserId!==a&&(this.update(c,d),b=!0);e?this.rubrics.toReadOnlyMode():this.rubrics.toAssessMode();this.currentUserId=a;this.assessment=this.score=null;return b};a.prototype.close=function(){CssModal.closeDialog();a.onClose()};
a.prototype.clear=function(){this.assessment=this.score=this.currentUserId=null};a.prototype.update=function(a,c){this.rubrics.clear();this.rubrics.update(a,c)};a.prototype.get=function(a){return a!==this.currentUserId?[]:this.rubrics.get()};a.prototype.getScore=function(a){return a!==this.currentUserId?null:this.score};a.prototype.getAssessment=function(a){return a!==this.currentUserId?null:this.assessment};a.prototype.isEmpty=function(a){return a!==this.currentUserId?!0:0===this.rubrics.get().length};
a.clientInstanceName=c.Constants.ClientInstanceNames.RubricAssessment;a.onClose=function(){$(document).trigger(c.Constants.Events.RubricAssessmentClosed)};a.onChangeScore=function(b){a.getInstance.score=b};a.onChangeAssessment=function(b){a.getInstance.assessment=b};return a}();e.RubricAssessment=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(a){var b=this;this.hiddenId=a.data.hiddenId;this.linkId=a.data.linkId;this.containerId=a.data.containerId;this.editorClientInstanceId=a.controls.editorClientInstanceId;if(window.opener)CKEDITOR.on("instanceReady",function(){var b=$(window.opener.document.getElementById(a.data.hiddenId));SetHtml(b.val(),a.controls.editorClientInstanceId);SetTextEditorFocus(a.controls.editorClientInstanceId);b.change(function(){$(this).parents("form").addClass(a.data.cssClasses.dirty)})});
$(a.controls.okButtonSelector).on("click",function(){return b.save()});$(a.controls.cancelButtonSelector).on("click",function(){return window.close()})}c.prototype.save=function(){if(window.opener){var a=GetTextEditorContent(this.editorClientInstanceId),b=$(window.opener.document.getElementById(this.containerId)),c=$(window.opener.document.getElementById(this.linkId)),d=$(window.opener.document.getElementById(this.hiddenId));d.val()!==a&&(b.html(a),d.val(a).trigger("change"));window.opener.TextEditorManager.refreshCustomOpenPopupButtonPosition(d,
c)}window.close()};return c}();c.Editor=e})(Assignment||(Assignment={}));var UploadStatus;(function(c){c[c.Awaiting=0]="Awaiting";c[c.InProgress=1]="InProgress";c[c.Succeeded=2]="Succeeded";c[c.SucceededWithErrors=3]="SucceededWithErrors";c[c.Failed=4]="Failed"})(UploadStatus||(UploadStatus={}));
(function(c){var e=function(){function c(a){this.settings=a}c.prototype.enablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,b){$(b).removeProp("disabled")})};c.prototype.disablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,b){$(b).prop("disabled",!0)})};c.prototype.onStatusChanged=function(a){switch(UploadStatus[a]){case "InProgress":this.disablePostButtons();break;case "Succeeded":case "SucceededWithErrors":case "Failed":this.enablePostButtons();
break;default:this.enablePostButtons()}};return c}();c.FileUploaderEventHandler=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){this.settings=a;this.$contentContainer=$(a.ContainerSelector);this.answerSubmitOnBehalfControl=new c.Controls.AnswerSubmitOnBehalf(this.settings.SubmitOnBehalfSettingsModel)}d.prototype.initialise=function(){var a=this;if(this.settings.ShowActionMenu){var b=$("#"+this.settings.FileViewerEllipsisButtonIdentifier);b.get(0)&&this.createActionMenu(b)}this.settings.UseIframe?(c.AllInOneGrader.endWaitForAnswerOrFile(),$(this.settings.FrameSelector).on("load",
function(){$(a.settings.EditButtonSelector).css("display","flex")})):CCL.CommonFunctions.safeAjax({url:this.settings.ViewUrl,type:"GET"}).done(function(b){a.$contentContainer.html(b)}).always(function(){c.AllInOneGrader.endWaitForAnswerOrFile()});this.showOnboarding();this.plagiarismStatusUpdater=new c.PlagiarismStatusUpdater(this.settings.AnswerId,this.settings.AnswerPlagiarismSettings.SetUsePlagiarismUrl,this.settings.PlagiarismStatusUpdaterSettings);this.settings.PlagiarismStatusUpdaterSettings&&
this.settings.PlagiarismStatusUpdaterSettings.HasAnyPlagiarismReportsInProcessing&&this.plagiarismStatusUpdater.attachUpdater()};d.showPreview=function(a){window.open(a,"","width="+.8*screen.width+", height="+.8*screen.height+", location = 0, directories = 0, toolbar = 0, scrollbars = 0, status = 0, menubars = 0, resizable = 1")};d.prototype.createActionMenu=function(a){var b=this;this.actionMenu=new CCL.ActionMenu(a,[new CCL.ActionMenuItem(this.settings.Terms.DownloadMenuItemText,"Download",function(){b.downloadClickHandler()})],
new CCL.ActionMenuSettings(CCL.ActionMenuHorizontalPosition.Left,CCL.ActionMenuOpeningMode.Click,c.Constants.AllInOneGraderActionMenuZIndex,!0,!0));$("."+c.CssClasses.Grader.AnswerContainer).scroll(function(){b.actionMenu.close()});(this.settings.AnswerPlagiarismSettings.CanSendAnswerForPlagiarism||this.settings.AnswerPlagiarismSettings.AllowResendForPlagiarism)&&this.addPlagiarismMenuItem();this.settings.SnapshotFileViewUrl&&0<this.settings.SnapshotFileViewUrl.length&&(a=new CCL.ActionMenuItem(this.settings.Terms.ViewLastSubmittedVersionMenuItemText,
"",function(){d.showPreview(b.settings.SnapshotFileViewUrl)}),this.actionMenu.addItem(a));this.settings.SubmitOnBehalfSettingsModel.SubmitOnBehalhUrl&&this.addEditAnswerMenuItem();this.settings.PlagiarismReportUrl&&this.addOpenPlagiarismReportMenuItem()};d.prototype.addPlagiarismMenuItem=function(){var a=this;this.plagiarismMenuItem=new CCL.ActionMenuItem("","SendPlagiarism",function(){c.PlagiarismReport.setUsePlagiarism(a.settings.AnswerId,a.plagiarismMenuItem,a.settings.AnswerPlagiarismSettings,
a.plagiarismStatusUpdater)});c.PlagiarismReport.updatePlagiarismMessage(this.plagiarismMenuItem,this.settings.AnswerPlagiarismSettings);this.actionMenu.addItem(this.plagiarismMenuItem)};d.prototype.addEditAnswerMenuItem=function(){var a=new CCL.ActionMenuItem(this.settings.SubmitOnBehalfSettingsModel.EditAnswerTerm,"EditAnswer",this.answerSubmitOnBehalfControl.openSubmitOnBehalfDialog);this.actionMenu.addItem(a)};d.prototype.addOpenPlagiarismReportMenuItem=function(){var a=this,b=new CCL.ActionMenuItem(this.settings.Terms.OpenPlagiarismReport,
"OpenPlagiarismReport",function(){c.PlagiarismReport.openPlagiarismReport(a.settings.PlagiarismReportUrl)});this.actionMenu.addItem(b)};d.prototype.downloadClickHandler=function(){window.open(this.settings.DownloadUrl)};d.prototype.showOnboarding=function(){var a=this,b=window[this.settings.FileViewerOnboardingDialogIdentifier];b&&(b.setCustomScripts({afterCloseDialog:function(){CCL.CommonFunctions.safeAjaxPost({url:a.settings.OnboardingUrl,data:{settingName:c.Constants.UserSettingsKey.IsGoogleDocOnboardingCompleted,
settingValue:"true"},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:a.settings.AntiForgerySettings.HeaderName,headerValue:a.settings.AntiForgerySettings.HeaderValue})})}}),b.openDialog(!1))};return d}();c.FileViewer=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){this.containerSelector=a}d.prototype.show=function(a,b){void 0===b&&(b="");CCL.InformationFeedback.showFeedback($(this.containerSelector),this.generateMessage(a,b),{disableAutomaticHiding:!0});return this};d.prototype.showWithButton=function(a,b,c,d,e){void 0===e&&(e=!0);CCL.CommonFunctions.isPhoneScreenSize()&&e?this.show(a,b).hide(5E3):CCL.InformationFeedback.showFeedback($(this.containerSelector),this.generateMessage(a,b),{disableAutomaticHiding:!0,extraButtonName:c,
extraButtonCallback:d});return this};d.prototype.hide=function(a){var b=this;void 0===a&&(a=0);setTimeout(function(){return CCL.InformationFeedback.hideFeedback($(b.containerSelector))},a);return this};d.prototype.generateMessage=function(a,b){return"<span class='"+(""===b?c.CssClasses.Common.InformationFeedbackMessage:"")+"' style='"+(""===b?"":"font-weight:bold; display: block;")+"'>"+a+"</span>"+b};return d}();c.InformationFeedbackWrapper=e})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(a,c,d,e){var b=this;void 0===e&&(e=null);this.nextStep=null;this.start=function(){b.controller.start()};this.startNextStep=function(){b.nextStep?b.nextStep.start():b.controller.next()};this.onboardingNotComplete=function(){var a=window[b.onboardingDialogId];a.isMobileView()||CCL.CommonFunctions.isMobileDevice()||($(window).on("resize",b.resizeHandler),a.blockHighlightZone=!0,a.openDialog(b.onboardingCloseHandler),b.overlay(!0))};this.onboardingComplete=
function(){b.startNextStep()};this.onboardingCloseHandler=function(a){$(window).off("resize",b.resizeHandler);a?b.controller.complete(b.featuresForComplete):b.startNextStep();b.controller.complete();b.overlay(!1)};this.resizeHandler=function(){var a=window[b.onboardingDialogId];a.isOpen&&a.isMobileView()&&(b.overlay(!1),$(window).off("resize",b.resizeHandler))};this.cssClasses=a;this.onboardingDialogId=c;this.featureId=d;this.controller=new CCL.Onboarding.Extensions.OnboardingPostMessageController(this.featureId,
e,this.onboardingComplete,this.onboardingNotComplete)}a.prototype.overlay=function(a){this.controller.overlay(a);$(document.body).toggleClass(this.cssClasses.Overlay,a)};return a}();c.Step=d})(c.Onboarding||(c.Onboarding={}))})(Assignment||(Assignment={}));
(function(c){(function(c){var d=CCL.Onboarding.Extensions.OnboardingFeatures,a=function(){function a(){}a.prototype.init=function(a,b){var f=new c.Step(b,a.getStartedDialogClientId,d.AssignmentGetStarted);f.featuresForComplete=[d.AssignmentEdit,d.AssignmentLearningToolOptions,d.AssignmentReminders];b=new c.Step(b,a.editAssignmentDialogClientId,d.AssignmentEdit,d.AssignmentLearningToolOptions);b.featuresForComplete=[d.AssignmentLearningToolOptions,d.AssignmentReminders];CCL.IframeContentHeightReporter.addSelectorToListenHeight("."+
a.Dialog);f.nextStep=b;f.start()};return a}();c.Tour=a})(c.Onboarding||(c.Onboarding={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.selectedUserIds=[];this.renderItem=function(a,d){return $("<li>").append(d.metadata?$('<a>\n                            <img alt="" class="'+c.CssClasses.Common.PersonProfileImage+'" src="'+b.getImageUrl(d.metadata)+'" />\n                       </a>').append($("<span/>").text(d.label)):"<span>"+b.settings.Terms.NoMatches+"</span>").appendTo(a)};this.onPeerSelected=function(a,c){c&&b.addPeer(c)};this.addPeer=function(a){var d=b.getImageUrl(a),
f=$('<div class="'+c.CssClasses.AddPeerDialog.Row+'" data-id="'+a.UserId+'"></div>');d=$('<div class="'+c.CssClasses.AddPeerDialog.Image+'"><img alt="" src="'+d+'" class="'+c.CssClasses.Common.PersonProfileImage+'"></div>');var e=$('<div class="'+c.CssClasses.AddPeerDialog.Name+'"></div>'),l=$('<div class="'+c.CssClasses.AddPeerDialog.Remove+'"></div>'),m=$('<a href="#">&times;</a>').prop("title",CCL.CommonFunctions.formatString(b.settings.Terms.RemoveX,a.FullName));l.append(m);m.click(b.onRemoveClick);
e.append($("<span></span>").text(a.FullName));f.data("metadata",a).append(d).append(e).append(l);$("#"+b.settings.Controls.SelectedPeersListClientId).append(f);b.selectedUserIds.push(a.UserId)};this.onRemoveClick=function(a){var d=$(a.target).parents("."+c.CssClasses.AddPeerDialog.Row);d.hide("fast",function(){var a=parseInt(d.attr("data-id"));b.selectedUserIds=b.selectedUserIds.filter(function(b){return b!==a});d.remove()});return!1};this.addSelectedPeers=function(){$.ajax({type:"PUT",url:b.settings.AddPeersApiUrl,
data:JSON.stringify({peerUserIds:b.selectedUserIds}),contentType:"application/json;charset=utf-8"}).done(function(){b.refreshGrid();b.cancelHandler();b.settings.RefreshAnswersGridOnAdd&&$(document).trigger(c.Constants.Events.AnswersGridDataChanged)});return!1};this.cancelHandler=function(){b.selectedUserIds=[];$("#"+b.settings.Controls.SelectedPeersListClientId).children("div").remove();CssModal.closeDialog();return!1};this.refreshGrid=function(){$.ajax({type:"GET",url:b.settings.TargetGridApiUrl}).done(function(a){$("#"+
b.settings.TargetGridClientId).html(a)}).fail(function(){CCL.CommonFunctions.jAjaxAlert(b.settings.Terms.ErrorOccured,"",b.settings.Terms.Ok)})};this.doSearch=function(a,c){a=b.settings.SearchPeersApiUrl+encodeURIComponent(a.term);$.ajax({url:a,type:"POST",data:JSON.stringify({peerUserIds:b.selectedUserIds}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){0<a.length?c($.map(a,function(a){return{label:a.FullName,value:a.PersonId,metadata:a}})):c([{}])}).fail(function(){CCL.CommonFunctions.jAjaxAlert(b.settings.Terms.ErrorOccured,
"",b.settings.Terms.Ok)})};this.settings=a;this.eventToHandle=a.LabeledInputSelectEventName+":"+a.PeerSearchType;$(function(){$(document).off(b.eventToHandle).on(b.eventToHandle,b.onPeerSelected);$("#"+b.settings.Controls.AddPeerButtonClientId).click(b.addSelectedPeers);$("#"+b.settings.Controls.CancelButtonClientId).click(b.cancelHandler);window[b.settings.Controls.AddPeerDialogClientId].setCustomScripts({afterOpenDialog:function(){$("#"+b.settings.Controls.PeerSearchInputControlClientId).focus()},
afterCloseDialog:function(){return b.cancelHandler()}})})}d.prototype.getImageUrl=function(a){return a.ProfilePictureUrl?a.ProfilePictureUrl:this.settings.DefaultProfilePictureUrl};return d}();c.AddPeersControl=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){var c=this;this.viewerCallback=b;this.options=a;if(b=document.getElementById(a.FileListClientId))b.addEventListener(a.Events.FileSelected,function(a){return c.handleItemSelected(a)}),b.addEventListener(a.Events.FileViewActivated,function(a){return c.handleItemViewActivated(a)}),b.addEventListener(a.Events.FileViewOriginalActivated,function(a){return c.handleItemViewOriginalActivated(a)}),b.addEventListener(a.Events.OpenPlagiarismReport,function(a){return d.openPlagiarismReport(a)})}
d.prototype.handleItemSelected=function(a){this.preview(a)};d.prototype.handleItemViewActivated=function(a){this.preview(a)};d.prototype.handleItemViewOriginalActivated=function(a){this.preview(a,!0)};d.prototype.preview=function(a,b){void 0===b&&(b=!1);a=a.detail;var c=a.File;if(c){var d=c.PreviewSettings;if(d&&d.Type){var e=d.Url;if(e&&b){e=e.replace(c.Metadata.id,c.SnapshotFileRepoId);var h=encodeURIComponent(encodeURIComponent(c.Metadata.signedFileRepoId));c=encodeURIComponent(encodeURIComponent(c.SnapshotFileRepoSignature));
e=e.replace(new RegExp(h,"gi"),c)}d.Type!==CCL.PreviewType.Custom&&d.Type!==CCL.PreviewType.Modal||!d.Url||b?a.DefaultHandler&&a.DefaultHandler():this.viewerCallback(e)}}};d.openPlagiarismReport=function(a){a=a.detail;a.File&&a.File.Metadata&&(a=a.File.Metadata,a.PlagiarismReportUrl&&c.PlagiarismReport.openPlagiarismReport(a.PlagiarismReportUrl))};return d}();c.FileList=e})(Assignment||(Assignment={}));
(function(c){var e;(function(a){a[a.Reviewers=0]="Reviewers";a[a.ForReview=1]="ForReview"})(e||(e={}));var d=function(){function a(a){var b=this;this.peerAssessmentAssessorDeleted=function(a,c,d){b.deletePeerReviewer(c,d,e.Reviewers,a.target)};this.peerAssessmentPeerToReviewDeleted=function(a,c,d){b.deletePeerReviewer(c,d,e.ForReview,a.target)};this.settings=a;$(function(){if(b.settings.Events.PeerAssessmentAssessorDeleted)$(document).off(b.settings.Events.PeerAssessmentAssessorDeleted).on(b.settings.Events.PeerAssessmentAssessorDeleted,
b.peerAssessmentAssessorDeleted);if(b.settings.Events.PeerAssessmentPeerToReviewDeleted)$(document).off(b.settings.Events.PeerAssessmentPeerToReviewDeleted).on(b.settings.Events.PeerAssessmentPeerToReviewDeleted,b.peerAssessmentPeerToReviewDeleted)})}a.prototype.deleteRow=function(a,b){var c=this,d=$("button[data-action='"+a[0].id+"']").closest("tr");if(b)d.hide("fast",function(){d.remove()});else{var f=d.children().length;d.hide("fast",function(){d.empty();$("<td>",{colspan:f,"class":c.settings.CssClasses.EmptyRow}).appendTo(d).text(c.settings.Terms.EmptyGridMessage);
d.show("fast")})}};a.prototype.deletePeerReviewer=function(a,b,d,h){var f=this;CCL.CommonFunctions.jAjaxConfirm(this.settings.Terms.RemovePeerReviewerConfirmationMessage,"",this.settings.Terms.Ok,this.settings.Terms.Cancel,function(g){g&&$.ajax({url:f.settings.Urls.PeerAssessorControllerUrl,type:"DELETE",data:JSON.stringify({answerId:a,userId:b,searchType:d}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){f.deleteRow($(h),a);d===e.Reviewers&&$(document).trigger(c.Constants.Events.AnswersGridDataChanged)}).fail(function(){return CCL.CommonFunctions.jAjaxAlert(f.settings.Terms.ErrorOccured,
"",f.settings.Terms.Ok)})})};return a}();c.PeerAssessmentGridManager=d;d=function(){return function(a){this.events=a}}();c.PeerAssessmentGrid=d;var a=function(a){function b(b){a.call(this,b)}__extends(b,a);b.prototype.triggerDeleteEvent=function(a,b,c){$("#"+c).trigger(this.events.PeerAssessmentAssessorDeleted,[a,b])};return b}(d);c.AssessorsGrid=a;d=function(a){function b(b){a.call(this,b)}__extends(b,a);b.prototype.triggerDeleteEvent=function(a,b,c){$("#"+c).trigger(this.events.PeerAssessmentPeerToReviewDeleted,
[a,b])};return b}(d);c.PeersToReviewGrid=d})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(){}d.openPlagiarismReport=function(a){window.open(a,"_blank")};d.updatePlagiarismMessage=function(a,b){a.isVisible=b.CanSendAnswerForPlagiarism||b.AllowResendForPlagiarism;a.Value=b.UsePlagiarism?b.Terms.CancelRequestPlagiarism:b.Terms.RequestPlagiarism};d.setUsePlagiarism=function(a,b,d,e){var f=this;b.isEnabled=!1;e.removeUpdater();CCL.CommonFunctions.safeAjax({url:d.SetUsePlagiarismUrl,type:"PUT",dataType:"json",data:{answerId:a,usePlagiarism:!d.UsePlagiarism&&
!d.AllowResendForPlagiarism,resend:d.AllowResendForPlagiarism}}).done(function(a){d.UsePlagiarism=!d.UsePlagiarism;f.updatePlagiarismMessage(b,d);d.AllowResendForPlagiarism&&(b.isVisible=!1);d.UsePlagiarism?($(document).trigger(c.Constants.Events.PlagiarismRequested),e.attachUpdaterWithInitialState(a)):($(document).trigger(c.Constants.Events.PlagiarismRequestCancel),a&&a.Success&&e.hidePlagiarismStatuses())}).always(function(){b.isEnabled=!0})};return d}();c.PlagiarismReport=e})(Assignment||(Assignment=
{}));
(function(c){var e=function(d){function a(b,f,e){var g=this;d.call(this);this.settings=b;this.headersList=f;b.controls.onboarding.isOnboardingEnabled&&(new c.Onboarding.Tour).init(b.controls.onboarding,b.data.onboardingCssClasses);this.currentZipTaskInfo=b.data.currentZipTaskInfo;this.gridEmptyTableCell=b.data.cssClasses.gridEmptyTableCell;this.$feedback=$("#"+b.controls.feedbackId);this.$feedbackText=$("#"+b.controls.feedbackTextId);this.$feedbackClose=$("#"+b.controls.feedbackCloseId);this.$warningFeedback=$("#"+
b.controls.warningFeedbackId);this.$warningFeedbackText=$("#"+b.controls.warningFeedbackTextId);this.$errorFeedback=$("#"+b.controls.errorFeedbackId);this.$errorFeedbackText=$("#"+b.controls.errorFeedbackTextId);this.$itemDownloadAnswersLink=$("#"+this.settings.controls.itemDownloadAnswersLink);$("#"+this.settings.controls.deleteSelectedAnswersLink).click(function(a){return g.checkBeforeDeleteAnswers(a)});$("#"+this.settings.controls.downloadAnswersLink).click(function(a){return g.checkBeforeDownload(a)});
$("#"+this.settings.controls.assessMultipleLink).click(function(){return g.checkBeforeAssess()});this.$feedbackClose.click(this.deleteExistingZiptaskAnswers.bind(this));$("#"+b.controls.gridTableId+" "+b.controls.gridClickableRowSelector).on("clickableRowClicked",function(a){return g.onGridClickableClick(a)});$("#"+b.controls.gridTableId+" "+b.controls.gridClickableRowSelector+" button["+a.assessLinkDataAttribute+"]").on("click",function(a){return g.onGridClickableClick(a)}).on("focus",function(a){$(a.target).closest("tr").addClass(CCL.CommonCssClasses.Grid.FocusedRow)}).on("blur",
function(a){$(a.target).closest("tr").closest("tr").removeClass(CCL.CommonCssClasses.Grid.FocusedRow)});this.settings.data.reloadSidebar&&this.postMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged);this.updateUi();this.currentZipTaskInfo.isValid&&this.startPolling();this.settings.data.showWarningIfAnonymousSubmissionAndGoogleFiles&&(this.$warningFeedbackText.html(this.settings.terms.anonymousSubmissionWithTemplateWarning),this.$warningFeedbackText.show(),this.$warningFeedback.show());
this.settings.data.showWarningIfAnonymousPeerAssessmentSubmissionAndGoogleFiles&&(this.$warningFeedbackText.html(this.settings.terms.anonymousPeerAssessmentWithTemplateWarning),this.$warningFeedbackText.show(),this.$warningFeedback.show());CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.studentWasAssessed,function(){window.location=window.location});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.showSettings));
$(document).on(b.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(b.urls.measureKpi,b.data.kpi.measureSection,b.data.kpi.measurement)},this));f=new c.Controls.Tooltip("draftTooltip",$("#"+b.controls.draftTooltipContentId));new c.Controls.TooltipToggler($("."+b.data.cssClasses.draftIndicator),f);f=new c.Controls.Tooltip("submittedLateTooltip",$("#"+b.controls.submittedLateTooltipContentId));new c.Controls.TooltipToggler($("."+b.data.cssClasses.submittedTooLateIndicator),f);
e&&e.UserId&&0<e.UserId.length&&$(function(){window[c.Constants.ClientInstanceNames.AllInOneGrader].open(e)})}__extends(a,d);a.prototype.onGridClickableClick=function(b){b=$(b.currentTarget).parents("tr").find("button.h-hidden");0<b.length&&(b=JSON.parse(b.attr(a.assessLinkDataAttribute)),window[c.Constants.ClientInstanceNames.AllInOneGrader].open(b,this.headersList),this.settings.data.isEdgeImmersiveReaderEnabled&&(new CCL.EdgeImmersiveReaderHelper).createEdgeReadablePostMessage({isPageEdgeReadable:!1}))};
a.prototype.updateUi=function(){if(!1===this.currentZipTaskInfo.isValid)this.$feedbackText.html(""),this.stopPolling(),this.$feedbackClose.show();else switch(this.currentZipTaskInfo.status){case this.settings.data.status.NotStarted:case this.settings.data.status.Waiting:case this.settings.data.status.InProgress:case this.settings.data.status.InProgressExternal:this.$feedbackText.html(this.settings.data.downloadingMessageTemplate);break;case this.settings.data.status.Ok:var a=this.settings.terms.readyMessageTemplate;
a=a.replace(this.settings.data.fileRepoToken,encodeURIComponent(this.currentZipTaskInfo.result));this.$feedbackText.html(a);this.stopPolling();this.$feedbackClose.show();this.$feedback.show();this.$itemDownloadAnswersLink.show();break;case this.settings.data.status.Error:this.stopPolling(),this.$feedback.hide(),this.$itemDownloadAnswersLink.show(),this.$errorFeedbackText.html(this.currentZipTaskInfo.result),this.$errorFeedback.show()}};a.prototype.checkAsyncTaskStatusAndUpdateUi=function(){var a=
this;$.ajax({type:"GET",url:this.settings.urls.serviceUrl,dataType:"json"}).done(function(b){a.currentZipTaskInfo.status!==b.Status&&(a.currentZipTaskInfo.status=b.Status,a.currentZipTaskInfo.result=b.Result,a.updateUi())}).fail(function(){a.stopPolling();a.$feedback.hide();a.$errorFeedbackText.html(a.settings.terms.errorOccured);a.$errorFeedback.show()})};a.prototype.checkStatus=function(){this.currentZipTaskInfo.isValid&&this.checkAsyncTaskStatusAndUpdateUi()};a.prototype.startPolling=function(){this.pollingIntervalId=
setInterval(this.checkStatus.bind(this),this.settings.data.pollingInterval)};a.prototype.stopPolling=function(){clearInterval(this.pollingIntervalId)};a.prototype.deleteExistingZiptaskAnswers=function(){CCL.CommonFunctions.safeAjax({url:this.settings.urls.deleteExistingZipAnswerstask,type:"DELETE",dataType:"json"})};a.prototype.checkBeforeDeleteAnswers=function(a){var b=this;0===window[this.settings.controls.gridId].getSelectedValues().length?CCL.CommonFunctions.jAjaxAlert(this.settings.terms.selectMessage,
"",this.settings.terms.ok):CCL.CommonFunctions.jAjaxConfirm(this.settings.terms.deleteAnswersQuestion,"",this.settings.terms.deleteButton,this.settings.terms.cancel,function(a){a&&(new Function(b.settings.controls.deleteAnswersPostbackRef))()});return!1};a.prototype.checkBeforeAssess=function(){return 0===window[this.settings.controls.gridId].getSelectedValues().length?(CCL.CommonFunctions.jAjaxAlert(this.settings.terms.selectMessage,"",this.settings.terms.ok),!1):!0};a.prototype.checkBeforeDownload=
function(a){var b=this;return this.checkBeforeActionOnAnswers(a,function(a){a?(new Function(b.settings.controls.downloadAnswersPostbackRef))():CCL.CommonFunctions.jAjaxAlert(b.settings.terms.nothingToDownload,"",b.settings.terms.ok)})};a.prototype.checkBeforeActionOnAnswers=function(a,c){var b=window[this.settings.controls.gridId].getSelectedValues(),d=$(a.currentTarget);if(d.hasClass("disabled"))return!1;if(0===b.length)return CCL.CommonFunctions.jAjaxAlert(this.settings.terms.selectMessage,"",this.settings.terms.ok),
!1;d.addClass("disabled");this.checkIfAnyAnswersExist(b,d,function(a){c(a);d.removeClass("disabled");d.parent("li").trigger("click")});return!1};a.prototype.checkIfAnyAnswersExist=function(a,c,d){var b=this;$.ajax({url:this.settings.urls.isAnyAnswerSubmittedByUsers,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify({assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId,userIds:a})}).done(function(a){d(a)}).fail(function(){c.removeClass("disabled");
CCL.CommonFunctions.jAjaxAlert(b.settings.terms.errorOccured,"",b.settings.terms.ok)})};a.assessLinkDataAttribute="data-for-grader";return a}(c.Base);c.Read=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.data.terms.navigateAwayMessage));this.settings=a;this.postMessageToHideSettings();new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass);$(this.settings.controls.okButtonSelector).click(function(){if(!IsEditorEmpty(a.controls.textEditorId)&&b.settings.data.hasAnyComment)return CCL.CommonFunctions.jAjaxConfirm(b.settings.data.terms.feedbackWarningMessage,
"",b.settings.data.terms.ok,b.settings.data.terms.cancel,function(a){a?(b.okHandler(),(new Function(b.settings.controls.okButtonPostBackRef))()):b.removeLoadingIndicator()}),!1;b.okHandler()});$("form").submit(function(){$(b.settings.controls.okButtonSelector).addClass(b.settings.data.cssClasses.buttonDisabled).prop("disabled",!1);return!0})}__extends(a,d);a.prototype.okHandler=function(){!1===window.Page_IsValid&&this.removeLoadingIndicator()};a.prototype.removeLoadingIndicator=function(){$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};
return a}(c.BaseEdit);c.AssessMultiple=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.settings=a;window[a.ClientInstanceName]||(window[a.ClientInstanceName]=this);this._dialog=window[a.DialogClientInstanceName];this.$dialogElement=$("#"+a.DialogClientInstanceName);this._dialog.setCustomScripts({afterOpenDialogAjaxDynamicallySuccess:function(){return b.attachEventHandlers()},afterCloseDialog:function(){return document.dispatchEvent(new Event(c.Constants.Events.AnswerViewingFinished))}});d.$cssModalContent=this.$dialogElement.find("."+
this.settings.CssClasses.CssModalContent);this.$dialogElement.on("click","."+this.settings.CssClasses.FileViewerBackLink,function(){document.dispatchEvent(new Event(c.Constants.Events.AnswerViewingFinished));b.loadPreviousPage()})}d.prototype.open=function(a){this._dialog&&(this._dialog.setAjaxUrl(a,{},!1),this._dialog.openDialog(!1),this.initialUrl=a,d.scrollTop=0)};d.loadViewer=function(a){window[c.Constants.ClientInstanceNames.ReviewPeerAssessmentDialog]&&(d.scrollTop=d.$cssModalContent.scrollTop(),
window[c.Constants.ClientInstanceNames.ReviewPeerAssessmentDialog].setAjaxUrl(a,{},!0))};d.prototype.loadPreviousPage=function(){this.initialUrl&&this._dialog.setAjaxUrl(this.initialUrl,{},!0)};d.prototype.attachEventHandlers=function(){var a=this.$dialogElement.find("."+this.settings.CssClasses.PeerAssessmentContentContainer);Tools.ExpandableSection.attachHandlerOnContainer(a);0!==a.length&&d.$cssModalContent.scrollTop(d.scrollTop)};d.scrollTop=0;return d}();c.ReviewPeerAssessment=e})(Assignment||
(Assignment={}));
(function(c){var e=function(){return function(){}}();c.SectionExpanderSettings=e;e=function(){return function(c){var a=c.expander.children("span.as-expander-text");c.target.attr("aria-labelledby",c.expander.prop("id"));c.target.attr("role","region");c.target.hasClass(c.cssClasses.sectionExpanderHide)&&c.target.attr("hidden","true");c.expander.click(function(){c.target.toggleClass(c.cssClasses.sectionExpanderHide);var b=!c.target.hasClass(c.cssClasses.sectionExpanderHide);a.text(b?c.terms.hide:c.terms.show);
c.expander.toggleClass("expanded",b);c.expander.attr("aria-expanded",b?"true":"false");b?c.target.removeAttr("hidden"):c.target.attr("hidden","true");c.expander.hasClass("as-section-expander-with-arrow")&&c.expander.closest("."+c.cssClasses.box).toggleClass(c.cssClasses.noPrint,!b)})}}();c.SectionExpander=e})(Assignment||(Assignment={}));
(function(c){var e=function(c){function a(a){var b=this;c.call(this);this.settings=a;$("#"+this.settings.controls.deleteAnswerButton).on("click",function(){return b.checkBeforeDeleteAnswer()});null!==this.settings.controls.commentModule&&(a=$("#"+this.settings.controls.commentModule).getCommentModuleObject())&&a.loadAndShow()}__extends(a,c);a.prototype.checkBeforeDeleteAnswer=function(){var a=this;CCL.CommonFunctions.jAjaxConfirm(this.settings.terms.deleteAnswerQuestion,"",this.settings.terms.deleteButtonText,
this.settings.terms.cancel,function(b){b&&CCL.CommonFunctions.safeAjax({type:"DELETE",url:a.settings.urls.deleteAnswerUrl}).done(function(){localStorage.removeItem(a.settings.data.answerAutoSaveLocalStorageKey);a.postMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged,{expandRead:a.settings.data.isCollaborationsUsed});window.location.href=window.location.href}).fail(function(){return CCL.CommonFunctions.jAjaxAlert(a.settings.terms.errorOccured,"",a.settings.terms.ok)})});return!1};
return a}(c.Base);c.StudentView=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(a){window[c.clientInstanceName]=this;this.settings=a;this.isFirstFunctionCall=!0;var b=this;if("undefined"!==typeof CKEDITOR)CKEDITOR.on("instanceReady",function(a){a=CKEDITOR.instances[b.settings.EditorClientInstanceId];b.settings.Label&&a.container.setAttribute("aria-label",b.settings.Label);if(b.isFirstFunctionCall&&"ready"===a.status){if(b.settings.IsToolbarExpanded){var c=a.getCommand(b.settings.ToolbarExpandedCommandName),d=c.editorFocus;c.editorFocus=
!1;a.execCommand(b.settings.ToolbarExpandedCommandName);c.editorFocus=d}a.on(b.settings.ToolbarExpandedEvent,function(a){b.toggleToolbar(a.data.expanded)});b.isFirstFunctionCall=!1;a.on("key",function(a){a.data.keyCode===CCL.CommonConstants.keyCodes.escape&&(window.location.href=b.settings.CssModalDefaultTarget)})}})}c.prototype.toggleToolbar=function(a){CCL.CommonFunctions.safeAjaxPost({dataType:"json",url:this.settings.SetUserPreferenceWebMethods,data:{category:this.settings.PageName,name:this.settings.EditorKeyForPreferences,
value:a}})};c.getEditorClientInstanceId=function(){return window[c.clientInstanceName].settings.EditorClientInstanceId};c.getEditorContent=function(){return GetTextEditorContent(c.getEditorClientInstanceId()).replace(/\n\n/g,"\n").replace(/\t/g," ")};c.setEditorContent=function(a){SetHtml(a,c.getEditorClientInstanceId())};c.clientInstanceName="TextEditorWrapperClientInstanceName";return c}();c.TextEditorWrapper=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.widont=function(a,b){0>=b||$(function(){$(a).each(function(a,c){var d=$(c).html().trim().split(" ");a=d.splice(-b,b).join("&nbsp;");d=d.join(" ");$(c).html(d+" "+a)})})};return c}();c.TextFormatting=e})(Tools||(Tools={}));
(function(c){var e=function(){function d(a){this.listenForPrintPostMessage=function(a){CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionPrintContentFrame,function(b){null!=b&&(document.title=b.headerText,$(a.controls.clientID).html(b.headerHtml));if("undefined"!==typeof CKEDITOR&&null!=CKEDITOR.instances)for(var c in CKEDITOR.instances)b=CKEDITOR.instances[c],$(b.container.$).find(".cke_top").addClass(a.data.cssClasses.noPrint),$(b.container.$).find(".cke_bottom").addClass(a.data.cssClasses.noPrint),
""===b.getData()?$("."+a.data.cssClasses.feedbackTextEditorPanel).addClass(a.data.cssClasses.noPrint):$("."+a.data.cssClasses.feedbackTextEditorPanel).removeClass(a.data.cssClasses.noPrint);CCL.CommonFunctions.isFirefox()&&(window.onbeforeprint=function(){$("."+a.data.cssClasses.fieldsetPrinting+" fieldset").each(function(){$(this).replaceWith($('<div class="fieldset">'+this.innerHTML+"</div>"))})},window.onafterprint=function(){$("."+a.data.cssClasses.fieldsetPrinting+" .fieldset").each(function(){$(this).replaceWith($("<fieldset>"+
this.innerHTML+"</fieldset>"))})});window.focus();window.print();$(document).trigger(a.data.calculateMeasureKpiEvent)})};this.listenForFullScreenPostMessages=function(){CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.enableFullScreen,function(){window.parent!==window&&CCL.CommonFunctions.makePostMessageCall(window.parent,{messageName:CCL.CommonWindowMessages.MessageNames.enableFullScreen});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.extensionContentOpened,
{iframeWidth:-1,iframeHeight:-1}));CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.iframeAutoHeight,{enabled:!0}))});CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.disableFullScreen,function(){window.parent!==window&&CCL.CommonFunctions.makePostMessageCall(window.parent,{messageName:CCL.CommonWindowMessages.MessageNames.disableFullScreen});CCL.CommonFunctions.makePostMessageCall(window.parent,
new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.iframeAutoHeight,{enabled:!1}))})};$.ajaxSetup({cache:!1});this.listenForPrintPostMessage(a);this.listenForFullScreenPostMessages();var b=navigator.userAgent.match(/Trident.*rv:11\./);CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionSettingsChanged,function(){b||(window.location=window.location)});Tools.TextFormatting.widont("."+c.CssClasses.Common.Widont,
3)}d.beforePrintCallback=function(a){return $(this).each(function(){if(void 0!==window.onbeforeprint)$(window).on("beforeprint",a);else window.matchMedia&&window.matchMedia("print").addListener(a)})};d.afterPrintCallback=function(a){return $(this).each(function(){if(void 0!==window.onafterprint)$(window).on("afterprint",a);else if(window.matchMedia)$(window).one("mouseover",a)})};return d}();c.Master=e})(Assignment||(Assignment={}));
